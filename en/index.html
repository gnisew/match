<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¥·çƒè¡£è¡Œè‹±èªé…å°éŠæˆ²</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        #game-container {
            text-align: center;
        }
		#game-board {
			display: grid;
			grid-template-columns: repeat(3, 1fr);
			gap: 10px;
			margin-top: 20px;
		}
		/* æ‰‹æ©Ÿç‰ˆé¢èª¿æ•´ */
		@media (max-width: 600px) {
			#game-board {
				grid-template-columns: repeat(2, 1fr);
			}
			.card {
			   padding: 15px !important;
			   font-size: 16px !important;
			}
		}
        .card:hover {
            background-color: #e0e0e0;
        }
        button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
        }
        #range-select {
            margin: 10px;
            padding: 13px 15px;
            font-size: 16px;
        }
        .card {
            background-color: #fff;
            border: 1px solid #ddd;
            padding: 20px;
            cursor: pointer;
            transition: background-color 0.3s;
			font-size: 24px;
        }
        .card.flipped {
            background-color: #ffff99;
        }
        .card.matched {
            background-color: #e0e0e0;
        }
.pair-button {
    background-color: #f0f0f0;
    border: 1px solid #ccc;  /* æ›´æ·ºçš„é‚Šæ¡†é¡è‰² */
    color: #333;
    padding: 10px 20px;
    margin: 5px;
    cursor: pointer;
    border-radius: 5px;  /* åœ“è§’ */
    transition: all 0.3s ease;  /* å¹³æ»‘éæ¸¡æ•ˆæœ */
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);  /* è¼•å¾®é™°å½±ä»£æ›¿æ˜é¡¯çš„é‚Šæ¡† */
}

.pair-button:hover {
    background-color: #e0e0e0;
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.pair-button.selected {
    background-color: #4a90e2;  /* é¸ä¸­æ™‚çš„é¡è‰² */
    color: white;
    border-color: #3a80d2;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}
        .vowel { color: #AA0000; }
        .semivowel { color: #4B0082; }
        .consonant { color: #0000AA; }
        #return-button {
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 16px;
            cursor: pointer;
            background: none;
            border: none;
        }
        #stats {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 16px;
            display: none;
        }
        @keyframes jumpAnimation {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        @keyframes shakeAnimation {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }

        .jump {
            animation: jumpAnimation 0.3s ease;
        }

        .shake {
            animation: shakeAnimation 0.3s ease;
        }

		#custom-wordlist-container {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			background-color: white;
			padding: 20px;
			border: 1px solid #ccc;
			box-shadow: 0 0 10px rgba(0,0,0,0.1);
			z-index: 1000;
		}

		#custom-wordlist-btn-container {
			width: 100%;
			text-align: center;
			margin: 10px 0;
		}

		#show-custom-wordlist-btn {
			display: inline-block;
		}
    </style>
</head>
<body>
    <div id="game-container">
        <button id="return-button" style="display: none;" onclick="returnToSetup()">X</button>
        <div id="stats">
            æ™‚é–“ï¼š<span id="time">00:00</span><br>
            æ­£ç¢ºç‡ï¼š<span id="accuracy">100%</span>
        </div>
        <h1>ğŸ¥·çƒè¡£è¡Œè‹±èªé…å°éŠæˆ²</h1>

		<div id="custom-wordlist-container" style="display: none;">
			<h2>è¼¸å…¥è‡ªè¨‚èªè©è¡¨</h2>
			<textarea id="custom-wordlist" rows="10" cols="50" placeholder="è«‹è¼¸å…¥è‡ªè¨‚èªè©è¡¨ï¼Œæ ¼å¼ç‚ºï¼šè‹±æ–‡\tä¸­æ–‡\næ¯è¡Œä¸€å€‹å–®è©å°"></textarea>
			<br>
			<button onclick="clearCustomWordlist()">æ¸…é™¤</button>
			<button onclick="closeCustomWordlist()">é—œé–‰</button>
			<button onclick="saveCustomWordlist()">ç¢ºèª</button>
		</div>		

        <div id="setup">
			<div id="custom-wordlist-btn-container">
				<button id="show-custom-wordlist-btn" onclick="showCustomWordlist()">è‡ªè¨‚èªè©è¡¨</button>
			</div>
            <h2>é¸æ“‡é…å°é …ç›®ï¼š</h2>			

            <h2>é¸æ“‡ç¯„åœï¼š</h2>			
            <select id="range-select" onchange="updateSelectedRange()">
                <option value="all">å…¨éƒ¨</option>
            </select>
            <button onclick="startGame()">é–‹å§‹éŠæˆ²</button>
        </div>
        <div id="game-board" style="display: none;"></div>
        <div id="game-controls" style="display: none;">
            <button onclick="continueGame()">ç¹¼çºŒ</button>
            <button onclick="returnToSetup()">è¿”å›</button>
        </div>
    </div>

    <script>
    const data = `
æ—¥æœŸ	è‹±æ–‡	ä¸­æ–‡é‡‹ç¾©	KKéŸ³æ¨™
Aug. 1, 2	barbecue	çƒ¤è‚‰ï¼›çƒ¤è‚‰èšæœƒ	['bÉ‘rbÉªkju]
Aug. 1, 2	drink	é£²æ–™	[drÉªÅ‹k]
Aug. 1, 2	hot dog	ç†±ç‹—	[hÉ‘t][dÉ”g]
Aug. 1, 2	burger	æ¼¢å ¡ï¼›æ¼¢å ¡ç‰›è‚‰é¤…	['bÉgÉš]
Aug. 1, 2	remember	è¨˜å¾—	[rÉª'mÉ›mbÉš]
Aug. 1, 2	meat	è‚‰ï¼ˆå¯é£Ÿç”¨çš„ï¼‰	[mit]
Aug. 1, 2	vegetable	è”¬èœ	['vÉ›dÊ’tÉ™bÉ™l]
Aug. 2, 5	corn	ç‰ç±³	[kÉ”rn]
Aug. 2, 5	salad	(è”¬èœ)æ²™æ‹‰	['sÃ¦lÉ™d]
Aug. 2, 5	watermelon	è¥¿ç“œ	['wÉ”tÉš,mÉ›lÉ™n]
`;


    let startTime;
    let timerInterval;
    let attempts = 0;
    let correctMatches = 0;

    let words = [];
    let dates = [];
    let selectedPair = ['english', 'chinese'];
    let selectedRange = 'all';
    let currentPairs = [];
    let flippedCards = [];
    let usedWords = new Set();

    const rightSound = new Audio('right.mp3');
    const wrongSound = new Audio('wrong.mp3');


let customData = '';

function showCustomWordlist() {
    document.getElementById('custom-wordlist-container').style.display = 'block';
    document.getElementById('show-custom-wordlist-btn').style.display = 'none';
}

function closeCustomWordlist() {
    document.getElementById('custom-wordlist-container').style.display = 'none';
    document.getElementById('show-custom-wordlist-btn').style.display = 'inline-block';
}

function saveCustomWordlist() {
    customData = document.getElementById('custom-wordlist').value;
    closeCustomWordlist();
    parseData();  // é‡æ–°è§£ææ•¸æ“š
}

function clearCustomWordlist() {
    document.getElementById('custom-wordlist').value = '';
    customData = '';
    parseData();  // é‡æ–°è§£ææ•¸æ“š
}


// ä¿®æ”¹parseDataå‡½æ•¸ä»¥è™•ç†è‡ªè¨‚æ•¸æ“š
function parseData() {
    const dataToUse = customData || data;  // å¦‚æœæœ‰è‡ªè¨‚æ•¸æ“šï¼Œä½¿ç”¨è‡ªè¨‚æ•¸æ“šï¼Œå¦å‰‡ä½¿ç”¨é»˜èªæ•¸æ“š
    const lines = dataToUse.trim().split('\n');
    const headers = lines[0].split('\t');
    
    // é‡ç½®å…¨å±€è®Šé‡
    words = [];
    dates = [];
    selectedPair = ['english', 'chinese'];  // é»˜èªç‚ºè‹±æ–‡-ä¸­æ–‡
    
    // æª¢æŸ¥æ¨™é¡Œä¸¦æ±ºå®šå¯ç”¨çš„é…å°é¸é …
    const hasKK = headers.includes('KKéŸ³æ¨™');
    const hasDate = headers.includes('æ—¥æœŸ');
    
    // ç”Ÿæˆé…å°é¸é …æŒ‰éˆ•
    const setupDiv = document.getElementById('setup');
    const pairButtons = setupDiv.querySelector('h2:first-of-type').nextElementSibling;
    pairButtons.innerHTML = '<button id="en-ch" class="pair-button selected" onclick="selectPair(\'english\', \'chinese\')">è‹±èª - ä¸­æ–‡</button>';
    
    if (hasKK) {
        pairButtons.innerHTML += '<button id="en-kk" class="pair-button" onclick="selectPair(\'english\', \'kk\')">è‹±èª - KKéŸ³æ¨™</button>';
        pairButtons.innerHTML += '<button id="kk-ch" class="pair-button" onclick="selectPair(\'kk\', \'chinese\')">KKéŸ³æ¨™ - ä¸­æ–‡</button>';
    }
    
    // è™•ç†æ—¥æœŸç¯„åœé¸æ“‡
    const rangeSelect = document.getElementById('range-select');
    rangeSelect.innerHTML = '<option value="all">å…¨éƒ¨</option>';
    
    let currentDate = '';  // ç”¨æ–¼å­˜å„²ç•¶å‰æ—¥æœŸ

    // è§£ææ•¸æ“š
    lines.slice(1).forEach(line => {
        const parts = line.split('\t');
        const wordObj = {};
        
        headers.forEach((header, index) => {
            if (header === 'æ—¥æœŸ' || header === 'åˆ†é¡') {
                if (parts[index].trim() !== '') {
                    currentDate = parts[index];
                    if (!dates.includes(currentDate)) {
                        dates.push(currentDate);
                    }
                }
                wordObj.date = currentDate;
            } else if (header === 'è‹±æ–‡' || header === 'English' || header === 'ENGLISH' || header === 'è‹±èª') {
                wordObj.english = parts[index];
            } else if (header === 'KKéŸ³æ¨™' || header === 'KK' || header === 'KK éŸ³æ¨™') {
                wordObj.kk = parts[index];
            } else if (header === 'ä¸­æ–‡é‡‹ç¾©' || header === 'ä¸­æ–‡' || header === 'Chinese' || header === 'chinese' || header === 'è¯èª' ) {
                wordObj.chinese = parts[index];
            }
        });
        
        if (wordObj.english && wordObj.chinese) {  // ç¢ºä¿è‡³å°‘æœ‰è‹±æ–‡å’Œä¸­æ–‡æ‰æ·»åŠ åˆ°å–®è©åˆ—è¡¨
            words.push(wordObj);
        }
    });
    
    // å¦‚æœæœ‰æ—¥æœŸï¼Œæ·»åŠ åˆ°ä¸‹æ‹‰é¸å–®
    if (hasDate) {
        dates.forEach(date => {
            const option = document.createElement('option');
            option.value = date;
            option.textContent = date;
            rangeSelect.appendChild(option);
        });
    } else {
        // å¦‚æœæ²’æœ‰æ—¥æœŸï¼Œç”Ÿæˆæ¯10å€‹å–®è©ä¸€çµ„çš„é¸é …
        const groups = Math.ceil(words.length / 10);
        for (let i = 0; i < groups; i++) {
            const option = document.createElement('option');
            option.value = `group${i + 1}`;
            option.textContent = `ç¬¬ ${i * 10 + 1} - ${Math.min((i + 1) * 10, words.length)} å€‹å–®è©`;
            rangeSelect.appendChild(option);
        }
    }
}


// æ ¹æ“šé¸æ“‡çš„ç¯„åœç²å–å¯ç”¨å–®è©
function getAvailableWords(selectedRange) {
    if (selectedRange === 'all') {
        return words.filter(word => !usedWords.has(word.english));
    } else if (selectedRange.startsWith('group')) {
        const groupNumber = parseInt(selectedRange.slice(5)) - 1;
        const start = groupNumber * 10;
        const end = Math.min((groupNumber + 1) * 10, words.length);
        return words.slice(start, end).filter(word => !usedWords.has(word.english));
    } else {
        return words.filter(word => word.date === selectedRange && !usedWords.has(word.english));
    }
}

// åœ¨é é¢åŠ è¼‰æ™‚èª¿ç”¨ parseData
window.onload = parseData;

    function populateDateDropdown() {
        const dropdown = document.getElementById('range-select');
        dates.forEach(date => {
            const option = document.createElement('option');
            option.value = date;
            option.textContent = date;
            dropdown.appendChild(option);
        });
    }

    function selectPair(first, second) {
        selectedPair = [first, second];
        document.querySelectorAll('.pair-button').forEach(btn => btn.classList.remove('selected'));
        document.getElementById(`${first.slice(0,2)}-${second.slice(0,2)}`).classList.add('selected');
    }

    function updateSelectedRange() {
        selectedRange = document.getElementById('range-select').value;
    }

	function startGame() {
		document.getElementById('setup').style.display = 'none';
		document.getElementById('game-board').style.display = 'grid';
		document.getElementById('game-controls').style.display = 'none';
		document.getElementById('return-button').style.display = 'block';
		document.getElementById('stats').style.display = 'none';
		document.getElementById('show-custom-wordlist-btn').style.display = 'none';

		startTime = new Date();
		timerInterval = setInterval(updateTimer, 1000);
		attempts = 0;
		correctMatches = 0;

		let availableWords = getAvailableWords(selectedRange);

		if (availableWords.length < 6) {
			usedWords.clear();
			availableWords = getAvailableWords(selectedRange);
		}
		
		currentPairs = shuffleArray(availableWords).slice(0, 6);
		currentPairs.forEach(word => usedWords.add(word.english));
		
		renderBoard();
	}

    function updateTimer() {
        const now = new Date();
        const diff = now - startTime;
        const minutes = Math.floor(diff / 60000);
        const seconds = Math.floor((diff % 60000) / 1000);
        document.getElementById('time').textContent = 
            `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function colorizeEnglishWord(word) {
        const vowels = ['a', 'e', 'i', 'o', 'u'];
        const semivowels = ['w', 'y'];
        return word.split('').map(char => {
            if (vowels.includes(char.toLowerCase())) {
                return `<span class="vowel">${char}</span>`;
            } else if (semivowels.includes(char.toLowerCase())) {
                return `<span class="semivowel">${char}</span>`;
            } else {
                return `<span class="consonant">${char}</span>`;
            }
        }).join('');
    }


function colorizeKKPhonetic(kk) {
    const vowels = ['É‘', 'Ã¦', 'É›', 'e', 'Éª', 'i', 'É”', 'o', 'ÊŠ', 'u', 'ÊŒ', 'É™', 'Éš', 'É'];
    const semivowels = ['j', 'w'];
    const specialChars = ['[', ']', ',', "'", ' '];

    return kk.split('').map(char => {
        if (vowels.includes(char)) {
            return `<span class="vowel">${char}</span>`;
        } else if (semivowels.includes(char)) {
            return `<span class="semivowel">${char}</span>`;
        } else if (!specialChars.includes(char)) {
            return `<span class="consonant">${char}</span>`;
        }
        return char;
    }).join('');
}

    function renderBoard() {
        const gameBoard = document.getElementById('game-board');
        gameBoard.innerHTML = '';
        
        const allCards = [...currentPairs.map(word => ({ word, type: selectedPair[0] })), 
                          ...currentPairs.map(word => ({ word, type: selectedPair[1] }))];
        const shuffledCards = shuffleArray(allCards);
        
        shuffledCards.forEach((card, index) => {
            const cardElement = document.createElement('div');
            cardElement.className = 'card';
            if (card.type === 'english') {
                cardElement.innerHTML = colorizeEnglishWord(card.word[card.type]);
            } else if (card.type === 'kk' && selectedPair.includes('kk') && selectedPair.includes('chinese')) {
                cardElement.innerHTML = colorizeKKPhonetic(card.word[card.type]);
            } else {
                cardElement.textContent = card.word[card.type];
            }
            cardElement.dataset.index = index;
            cardElement.onclick = () => flipCard(cardElement, card);
            gameBoard.appendChild(cardElement);
        });
    }

    function flipCard(cardElement, card) {
        if (flippedCards.length < 2 && !flippedCards.some(fc => fc.element === cardElement) && !cardElement.classList.contains('matched')) {
            cardElement.classList.add('flipped');
            flippedCards.push({ element: cardElement, card: card });
            
            if (card.type === 'english') {
                speakWord(card.word.english);
            }
            
            if (flippedCards.length === 2) {
                setTimeout(checkMatch, 10);
            }
        }
    }


    function checkMatch() {
        const [card1, card2] = flippedCards;
        attempts++;
        if (card1.card.word === card2.card.word && card1.card.type !== card2.card.type) {
            card1.element.classList.add('matched', 'jump');
            card2.element.classList.add('matched', 'jump');
            speakWord(card1.card.word.english);
            rightSound.play();
            correctMatches++;

            // ç§»é™¤è·³å‹•å‹•ç•«é¡åˆ¥
            setTimeout(() => {
                card1.element.classList.remove('jump');
                card2.element.classList.remove('jump');
            }, 300);
        } else {
            card1.element.classList.add('shake');
            card2.element.classList.add('shake');
            wrongSound.play();

            // ç§»é™¤æ™ƒå‹•å‹•ç•«é¡åˆ¥ä¸¦ç¿»å›å¡ç‰‡
            setTimeout(() => {
                card1.element.classList.remove('shake', 'flipped');
                card2.element.classList.remove('shake', 'flipped');
            }, 300);
        }
        flippedCards = [];

        if (document.querySelectorAll('.card:not(.matched)').length === 0) {
            clearInterval(timerInterval);
            showStats();
            setTimeout(showGameControls, 10);
        }
    }


    function showStats() {
        const accuracy = Math.round((correctMatches / attempts) * 100);
        document.getElementById('accuracy').textContent = `${accuracy}%`;
        document.getElementById('stats').style.display = 'block';
    }

    function showGameControls() {
        document.getElementById('game-controls').style.display = 'block';
    }

    function speakWord(word) {
        const utterance = new SpeechSynthesisUtterance(word);
        utterance.lang = 'en-US';
        window.speechSynthesis.speak(utterance);
    }

    function continueGame() {
        document.getElementById('game-controls').style.display = 'none';
        startGame();
    }

    function returnToSetup() {
        document.getElementById('game-board').style.display = 'none';
        document.getElementById('game-controls').style.display = 'none';
        document.getElementById('setup').style.display = 'block';
        document.getElementById('return-button').style.display = 'none';
        document.getElementById('stats').style.display = 'none';
		document.getElementById('show-custom-wordlist-btn').style.display = 'inline-block';
        clearInterval(timerInterval);
    }

    // åˆå§‹åŒ–
    parseData();
    populateDateDropdown();
    </script>
</body>
</html>