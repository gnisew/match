<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü•∑ÁÉèË°£Ë°åËã±Ë™ûÈÅäÊà≤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        #game-container {
            text-align: center;
        }
		#game-board {
			display: grid;
			grid-template-columns: repeat(3, 1fr);
			gap: 10px;
			margin-top: 20px;
		}
		/* ÊâãÊ©üÁâàÈù¢Ë™øÊï¥ */
		@media (max-width: 600px) {
			#game-board {
				grid-template-columns: repeat(2, 1fr);
			}
			.card {
			   padding: 15px 10px !important;
			   font-size: 20px !important;
			}
		}
        .card:hover {
            background-color: #e0e0e0;
        }
        button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
        }
        #range-select {
            margin: 10px;
            padding: 13px 15px;
            font-size: 16px;
        }
        .card {
            background-color: #fff;
            border: 1px solid #ddd;
            padding: 20px;
            cursor: pointer;
            transition: background-color 0.3s;
			font-size: 24px;
			user-select: none;
        }
        .card.flipped {
            background-color: #ffff99;
        }
        .card.matched {
            background-color: #e0e0e0;
        }
		.pair-button {
			background-color: #f0f0f0;
			border: 1px solid #ccc;
			color: #333;
			padding: 10px 20px;
			margin: 5px;
			cursor: pointer;
			border-radius: 5px;
			transition: all 0.3s ease;
			box-shadow: 0 2px 4px rgba(0,0,0,0.1);
		}

		.pair-button:hover {
			background-color: #e0e0e0;
			box-shadow: 0 4px 8px rgba(0,0,0,0.15);
		}

		.pair-button.selected {
			background-color: #4a90e2;
			color: white;
			border-color: #3a80d2;
			box-shadow: 0 2px 4px rgba(0,0,0,0.2);
		}

        .vowel { color: #AA0000; }
        .semivowel { color: #4B0082; }
        .consonant { color: #0000AA; }
		.kk-bracket {
		    color: #555 !important;
		}
		#word-list-table .clickable .kk-bracket {
			color: #555 !important;
		}

        #return-button {
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 16px;
            cursor: pointer;
            background: none;
            border: none;
        }
        #stats {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 16px;
            display: none;
        }
        @keyframes jumpAnimation {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        @keyframes shakeAnimation {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }

        .jump {
            animation: jumpAnimation 0.3s ease;
        }

        .shake {
            animation: shakeAnimation 0.3s ease;
        }

#custom-wordlist-container {
    position: fixed; 
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0,0,0,0.15);
    z-index: 1000;
    max-height: 90vh;
    width: 90%;
    max-width: 500px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.custom-wordlist-scroll {
    flex-grow: 1;
    overflow-y: auto;
    margin-top: 20px;
    padding-right: 10px;
    max-height: calc(90vh - 300px); 
}

#custom-wordlist {
    width: 95%;
    resize: vertical;
    min-height: 100px;
    max-height: 200px;
    overflow-y: auto;
    border: 0.5px solid #ccc;
    border-radius: 5px;
    padding: 10px;
    font-size: 14px;
}

.correctAnswerElement{
    user-select: none;
    font-size: 36px;
}

#custom-wordlist {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
}

#custom-wordlist {
    transform: translateZ(0);
}

.button-group {
    display: flex;
    justify-content: space-between;
    margin-top: 15px;
}

.button-group button {
    padding: 8px 15px;
    border: none;
    border-radius: 5px;
    background-color: #4a90e2;
    color: white;
    cursor: pointer;
    transition: background-color 0.3s;
}

.button-group button:hover {
    background-color: #3a80d2;
}

.wordlist-item {
    background-color: #f5f5f5;
    border-radius: 5px;
    padding: 0px 10px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.wordlist-name {
    font-weight: bold;
}

.wordlist-actions button {
    padding: 5px 10px;
    margin-left: 5px;
    border: none;
    border-radius: 3px;
    background-color: #e0e0e0;
    cursor: pointer;
    transition: background-color 0.3s;
}

.wordlist-actions button:hover {
    background-color: #d0d0d0;
}

h1 {
	user-select: none;
}

h2 {
    margin-top: 0;
    margin-bottom: 15px;
    color: #333;
	user-select: none;
}
		#saved-wordlists {
			margin-top: 20px;
		}

		#custom-wordlist-btn-container {
			width: 100%;
			text-align: center;
			margin: 10px 0;
		}

		#show-custom-wordlist-btn {
			display: inline-block;
		}


        #view-words-btn {
            margin-left: 10px;
        }
        
        #word-list-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 800px;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

		#word-list-table {
			width: 100%;
			border-collapse: collapse;
		}

		#word-list-table th, #word-list-table td {
			border: 1px solid #ddd;
			padding: 8px;
			text-align: left;
		}

		#word-list-table th {
			background-color: #f2f2f2;
		}

		#word-list-table tr:nth-child(even) {
			background-color: #f9f9f9;
		}


		#word-list-table .clickable {
			cursor: pointer;
			text-decoration: none;
			color: #333;
		}

		#saved-wordlists {
			margin-top: 20px;
		}
		.wordlist-item {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 10px;
		}
		.wordlist-name {
			cursor: pointer;
		}

		#game-board {
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			height: 100%;
		}

		#game-board {
			margin-bottom: 20px;
			text-align: center;
			word-break: break-all;
		}

		.word-display {
			font-size: 36px;
			margin-bottom: 20px;
			text-align: center;
			word-break: break-all;
		}
		#game-board input {
			font-size: 36px;
			padding: 10px 15px;
			border: 2px solid #ccc;
			border-radius: 5px;
			text-align: center;
			width: 300px;
			max-width: 80%;
			outline: none;
			transition: border-color 0.3s;
		}

		#game-board input:focus {
			border-color: #4a90e2;
		}



input::placeholder {
    color: #CCCCCC;
    opacity: 1;
}

input::-webkit-input-placeholder { 
    color: #CCCCCC;
}
input::-moz-placeholder { 
    color: #CCCCCC;
}
input:-ms-input-placeholder {
    color: #CCCCCC;
}
input:-moz-placeholder {
    color: #CCCCCC;
}



#column-checkboxes {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 15px;
}

#column-checkboxes label {
    display: flex;
    align-items: center;
    cursor: pointer;
}

#column-checkboxes input[type="checkbox"] {
    margin-right: 5px;
}
.clickable {
  cursor: pointer;
  text-decoration: underline;
  color: #0000FF;
}

.clickable:hover {
  background-color: #f0f0f0;
}










.game-container {  
  background-color: #f0f0f0;
  border-radius: 8px;
  padding: 40px 20px 20px;
  margin-top: 20px;
  box-shadow: 0 2px 2px rgba(0,0,0,0.1);
  position: relative;
}

.game-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-top: 10px;
}

.game-question {
  font-size: 1.2em;
  margin-bottom: 20px;
  text-align: center;
}

.word-tile {
  background-color: #fff;
  border: 1px solid #ddd;
  border-radius: 5px;
  padding: 5px 10px;
  margin: 5px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.word-tile:hover {
  background-color: #e6e6e6;
}

.answer-area {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  min-height: 60px;
  margin-bottom: 20px;
  padding: 10px;
  border-radius: 5px;
}

.answer-area::after {
  content: '';
  width: 100%;
  border-bottom: 2px solid #ddd;
  margin-top: 10px;
}

.word-bank {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  margin-bottom: 20px;
}

.game-controls {
  display: flex;
  justify-content: center;
  gap: 10px;
}

.game-controls button {
  padding: 10px 20px;
  font-size: 1em;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}



.close-button {
  position: absolute;
  top: 10px;
  left: 10px;
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  color: #888;
}

#checkButton {
  background-color: #4CAF50;
  color: white;
}

#checkButton:hover {
  background-color: #45a049;
}

#nextButton {
  background-color: #008CBA;
  color: white;
}

#nextButton:hover {
  background-color: #007aa3;
}


.progress-bar-container {
  position: absolute;
  top: 15px;
  right: 10px;
  left: 60px;
  margin-right: 60px;
  font-size: 14px;
}
.progress-bar-background {
  width: 100%;
  height: 20px;
  background-color: #e0e0e0;
  border-radius: 10px;
  overflow: hidden;
}

.progress-bar-fill {
  height: 100%;
  background-color: #4CAF50;
  width: 0;
  transition: width 0.3s ease-in-out;
}
.progress-text {
  position: absolute;
  top: -2px;
  right: 20px;
  text-align: center;
  margin-top: 5px;
  color: white;
}


  .audio-button-container {
    display: flex;
    justify-content: center;
    width: 100%;
    margin: 10px 0;
  }
    .mute-button {
  position: absolute;
  top: 5px;
  right: 0px;
        background: none;
        border: none;
        font-size: 22px;
        cursor: pointer;
    }

@keyframes jumpAnimation {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-5px); }
}

@keyframes shakeAnimation {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-3px); }
    75% { transform: translateX(3px); }
}

.jump {
    animation: jumpAnimation 0.3s ease;
}

.shake {
    animation: shakeAnimation 0.3s ease;
}

#gameResult {
  position: relative;
  z-index: 1001;
  background-color: rgba(255, 255, 255, 0.8);
  padding: 20px;
  border-radius: 10px;
  text-align: center;
}

    </style>
</head>
<body>
    <div id="game-container">
        <button id="return-button" style="display: none;" onclick="returnToSetup()">X</button>
        <div id="stats">
            ÊôÇÈñìÔºö<span id="time">00:00</span><br>
            Ê≠£Á¢∫ÁéáÔºö<span id="accuracy">100%</span>
        </div>
        <h1>ü•∑ÁÉèË°£Ë°åËã±Ë™ûÈÅäÊà≤</h1>

		<div id="custom-wordlist-container" style="display: none;">
			<span class="close" onclick="closeCustomWordlist()">&times;</span>
			<h2>Ëº∏ÂÖ•Ëá™Ë®ÇË™ûË©ûË°®</h2>
			<textarea id="custom-wordlist" placeholder="Ë´ãËº∏ÂÖ•Ëá™Ë®ÇË™ûË©ûË°®ÔºåÊ†ºÂºèÁÇ∫ÔºöËã±Êñá\t‰∏≠Êñá\nÊØèË°å‰∏ÄÂÄãÂñÆË©ûÂ∞ç"></textarea>
			<div class="button-group">
				<button onclick="clearCustomWordlist()">Ê∏ÖÈô§</button>
				<button onclick="saveCustomWordlist()">ÂÑ≤Â≠ò</button>
				<button onclick="closeCustomWordlist()">ÈóúÈñâ</button>
				<button onclick="confirmCustomWordlist()">Á¢∫Ë™ç</button>
			</div>
			<div class="custom-wordlist-scroll">
				<div id="saved-wordlists"></div>
			</div>
		</div>

        <div id="setup">
			<div id="custom-wordlist-btn-container">
				<button id="show-custom-wordlist-btn" onclick="showCustomWordlist()">Ëá™Ë®ÇË™ûË©ûË°®</button>
			</div>
            <h2>ÈÅ∏ÊìáÈÖçÂ∞çÈ†ÖÁõÆÔºö</h2>			

            <h2>ÈÅ∏ÊìáÁØÑÂúçÔºö</h2>			
            <select id="range-select" onchange="updateSelectedRange()">
                <option value="all">ÂÖ®ÈÉ®</option>
            </select>
            <button onclick="startGame()">ÈñãÂßãÈÖçÂ∞ç</button>
			<button onclick="startSpellingGame()">ÈñãÂßãÊãºÂ≠ó</button>
			<button onclick="startSentenceGame()" class="game-button">ÈñãÂßãÊéíÂ∫è</button>
			<button id="view-words-btn" onclick="showWordList()">Ê™¢Ë¶ñË™ûË©û</button>
        </div>
        <div id="game-board" style="display: none;"></div>
        <div id="game-controls" style="display: none;">
            <button onclick="continueGame()">ÁπºÁ∫å</button>
            <button onclick="returnToSetup()">ËøîÂõû</button>
        </div>


<div id="gameContainer" class="game-container" style="display: none;">
    <button id="closeButton" class="close-button" onclick="closeGame()">X</button>
    <div class="progress-bar-container">
        <div class="progress-bar-background">            
            <div class="progress-bar-fill"></div>
        </div>
        <div class="progress-text"></div>
    </div>
    <button id="muteButton" class="mute-button" onclick="toggleMute()">üîä</button>
    <div id="gameContent" class="game-content">
        <div class="audio-button-container">
            <button id="gameAudioButton" class="audio-button" onclick="playGameAudio()">üîä</button>
        </div>
        <h2 id="gameQuestion" class="game-question"></h2>
        <div id="answerArea" class="answer-area"></div>
        <div id="wordBank" class="word-bank"></div>
        <div class="game-controls">                
            <button id="checkButton" onclick="checkAnswer()">Á¢∫Ë™ç</button>
            <button id="endGameButton" class="end-game-button" onclick="endGame()" style="display: none;">ÁµêÊùü</button>
            <button id="nextButton" onclick="nextQuestion()" style="display: none;">ÁπºÁ∫å</button>
        </div>
    </div>
</div>

	  <div id="gameResult" class="game-result" style="display: none;">
		<h2>üéä ÈÅäÊà≤ÁµêÊùü üéä</h2>
		<p>ÊÇ®Â∑≤ÂÆåÊàêÊâÄÊúâÂè•Â≠êÔºÅ</p>
		<div class="result-stats">
		  <p>Ê≠£Á¢∫ÁéáÔºö<span id="accuracyRate"></span></p>
		</div>
		<button id="closeGameButton" onclick="closeGame()">ÈóúÈñâ</button>
		<button id="restartButton" onclick="restartGame()">ÈáçÊñ∞ÈñãÂßã</button>
		<button id="nextButton2" onclick="nextQuestion2()" style="display: none;">ÁπºÁ∫å</button>
	  </div>


        <div id="word-list-modal">
            <div class="modal-content">
                <span class="close" onclick="closeWordList()">&times;</span>
                <h2>Ë©ûË°®</h2>
                <table id="word-list-table">
                    <thead>
                        <tr>
                            <th>Ëã±Êñá</th>
                            <th>KKÈü≥Ê®ô</th>
                            <th>‰∏≠ÊñáÈáãÁæ©</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Ë°®Ê†ºÂÖßÂÆπÂ∞áÁî± JavaScript ÂãïÊÖãÁîüÊàê -->
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
    const localStorage = "enc";
    const data = `
Êó•Êúü	Ëã±Ë™û	‰∏≠Êñá	KKÈü≥Ê®ô	Ëã±Ë™ûÂè•Â≠ê	‰∏≠ÊñáÂè•Â≠ê
1	sausage	È¶ôËÖ∏;ËáòËÖ∏	['s…îs…™ §]	Do you want {sausage} for breakfast?	Êó©È§êÊÉ≥ÂêÉÈ¶ôËÖ∏ÂóéÔºü
1	goat	Â±±Áæä	[go ät]	The farmer has seven {goats}.	Ëæ≤Â§´Êúâ‰∏ÉÈöªÂ±±Áæä„ÄÇ
1	spicy	ËæõËæ£ÁöÑ	['spa…™si]	Can you eat {spicy} food?	ÂèØ‰ª•ÂêÉËæõËæ£ÁöÑÈ£üÁâ©ÂóéÔºü
1	pizza	Êä´Ëñ©	['pi ¶…ô]	What toppings do you want on the {pizza}?	ÊÇ®ÊÉ≥Âú®Êä´Ëñ©‰∏äÂä†‰ªÄÈ∫ºÈÖçÊñôÔºü
1	ketchup	Áï™ËåÑÈÜ¨	['k…õ ß…ôp]	I want some {ketchup} on my hot dog.	ÊàëÊÉ≥Âú®ÁÜ±Áãó‰∏äÂä†ÈªûÁï™ËåÑÈÜ¨„ÄÇ
2	pleasant	‰ª§‰∫∫ÊÑâÂø´ÁöÑ	['pl…õz…ônt]	I had a {pleasant} time today.	Êàë‰ªäÂ§©ÈÅéÂæóÂæàÊÑâÂø´„ÄÇ
2	side dish	ÈÖçËèú;Â∞èËèú	[sa…™d d…™ É]	What {side dish} would you like?	ÊÇ®ÊÉ≥Ë¶Å‰ªÄÈ∫ºÈÖçËèúÔºü
2	fries	ÁÇ∏ËñØÊ¢ù	[fra…™z]	These {fries} have a nice crunch to them.	ÈÄô‰∫õËñØÊ¢ùÊúâÂæàÂ•ΩÁöÑÂòéÂê±ËÅ≤„ÄÇ
2	pick up	Ë≥ºË≤∑	[p…™k  åp]	Can you {pick up} some eggs at the store?	‰Ω†ËÉΩÂú®ÂïÜÂ∫óË≤∑‰∏Ä‰∫õÈõûËõãÂóéÔºü
2	onion	Ê¥ãËî•	[' ånj…ôn]	He put {onions} on his sandwich.	‰ªñÂú®‰∏âÊòéÊ≤ª‰∏äÊîæ‰∫ÜÊ¥ãËî•„ÄÇ
3	large	Â§ßÁöÑ	[l…ër §]	That dog is very {large}.	ÈÇ£ÈöªÁãóÂæàÂ§ß„ÄÇ
3	marvelous	ÁµïÁæéÁöÑ;Â•ΩÊ•µÁöÑ	['m…ërv…ôl…ôs]	I saw some {marvelous} scenery in Korea.	ÊàëÂú®ÈüìÂúãÁúãÂà∞‰∫Ü‰∏Ä‰∫õÂ•áÂ¶ôÁöÑÈ¢®ÊôØ„ÄÇ
3	church	ÊïôÂ†Ç	[ ß…ù ß]	Everyone was quiet in the {church}.	ÊïôÂ†ÇË£°ÊâÄÊúâ‰∫∫ÈÉΩÂæàÂÆâÈùú„ÄÇ
3	square	Âª£Â†¥	[skw…õr]	Is there a {square} in the middle of town?	Â∏Ç‰∏≠ÂøÉÊúâÂª£Â†¥ÂóéÔºü
3	move	(‰Ωø)ÁßªÂãï	[muv]	My little brother won't stop {moving}.	ÊàëÁöÑÂºüÂºü‰∏çÊúÉÂÅúÊ≠¢ÂâçÈÄ≤„ÄÇ
4	festival	ÁØÄÊÖ∂;ÁØÄÊó•	['f…õst…™v…ôl]	Come to the music {festival} this weekend!	ÈÄôÂÄãÈÄ±Êú´Â∞±‰æÜÂèÉÂä†Èü≥Ê®ÇÁ•≠ÂêßÔºÅ
4	band	Ê®ÇÈöä;Ê®ÇÂúò	[b√¶nd]	Let's listen to the {band} play.	ÊàëÂÄë‰æÜËÅΩËÅΩÊ®ÇÂúòÁöÑÊºîÂ•èÂêß„ÄÇ
4	wall	ÁâÜ	[w…îl]	What's on the other side of the {wall}?	ÁâÜÁöÑÂè¶‰∏ÄÈÇäÊòØ‰ªÄÈ∫ºÔºü
4	surround	ÂúçÁπû	[s…ô'ra änd]	Trees and plants {surround} the lake.	Ê®πÊú®ÂíåÊ§çÁâ©Áí∞ÁπûËëóÊπñÊ≥ä„ÄÇ
4	market	Â∏ÇÈõÜ;Â∏ÇÂ†¥	['m…ërk…™t]	What did you buy at the {market}?	‰Ω†Âú®Â∏ÇÂ†¥‰∏äË≤∑‰∫Ü‰ªÄÈ∫ºÔºü
7	centimeter	ÂÖ¨ÂàÜ	['s…õnt…ôÀåmit…ôr]	The ruler is 15 {centimeters} long.	Â∞∫Â≠êÈï∑15ÂÖ¨ÂàÜ„ÄÇ
7	weight	ÈáçÈáè	[we…™t]	What's the {weight} of your dog?	‰Ω†ÁöÑÁãóÁöÑÈ´îÈáçÊòØÂ§öÂ∞ëÔºü
7	gram	ÂÖ¨ÂÖã	[gr√¶m]	How many {grams} of sugar do you need?	ÊÇ®ÈúÄË¶ÅÂ§öÂ∞ëÂÖãÁ≥ñÔºü
7	eagle	È∑π	['ig…ôl]	I see an {eagle} in the sky.	ÊàëÁúãÂà∞Â§©Á©∫‰∏≠Êúâ‰∏ÄÈöªÈ∑π„ÄÇ
7	goose	Èµù	[gus]	A {goose} is swimming in the lake.	‰∏ÄÈöªÈµùÊ≠£Âú®ÊπñË£°Ê∏∏Ê≥≥„ÄÇ
8	fence	Ê¨ÑÊùÜ;ÂúçÁ±¨	[f…õns]	It's right around the {fence}.	Â∞±Âú®ÊüµÊ¨ÑÂë®Âúç„ÄÇ
8	focus	(‰Ωø)ËÅöÁÑ¶	['fo äk…ôs]	Let's {focus} on the problem.	ËÆìÊàëÂÄëÈáçÈªûÈóúÊ≥®ÈÄôÂÄãÂïèÈ°å„ÄÇ
8	point	Âú∞Èªû	[p…î…™nt]	At which {point} do you want to meet?	ÊÇ®ÊÉ≥Âú®‰ªÄÈ∫ºÊôÇÂÄôË¶ãÈù¢Ôºü
8	quickly	Âø´ÈÄüÂú∞	['kw…™kli]	Don moved {quickly} through the park.	ÂîêÂø´ÈÄüÁ©øÈÅéÂÖ¨Âúí„ÄÇ
8	path	ÈÅìË∑Ø;ÈÄöË∑Ø	[p√¶Œ∏]	Just stay on the {path}.	Â∞±ÁïôÂú®Ë∑Ø‰∏äÂêß„ÄÇ
9	guy	‰∫∫	[ga…™]	Which {guy} did you talk to?	‰Ω†ÂíåÂì™ÂÄãÂÇ¢‰ºôË™™Ë©±‰∫ÜÔºü
9	train	Ë®ìÁ∑¥	[tre…™n]	He's {training} to run in a race.	‰ªñÊ≠£Âú®Ë®ìÁ∑¥ÂèÉÂä†ÊØîË≥Ω„ÄÇ
9	fit	ÂÅ•Â∫∑ÁöÑ;ÂÅ•ÁæéÁöÑ	[f…™t]	Joan is very strong and {fit}.	ÁìäÈùûÂ∏∏Âº∑Â£Ø„ÄÅÂÅ•Â∫∑„ÄÇ
9	test	ËÄÉÈ©ó;Ê∏¨Ë©¶	[t…õst]	Is the boy honest? Let's {test} it out.	ÈÄôÂ≠©Â≠êË™†ÂØ¶ÂóéÔºüÊàëÂÄë‰æÜÊ∏¨Ë©¶‰∏Ä‰∏ã„ÄÇ
9	mind	ÂøÉÊô∫	[ma…™nd]	Sophie's on my {mind}.	ËòáËè≤Âú®ÊàëÁöÑËÖ¶Êµ∑Ë£°„ÄÇ
10	sick	ÁîüÁóÖÁöÑ	[s…™k]	Paul isn't here today. He's {sick}.	‰øùÁæÖ‰ªäÂ§©Ê≤í‰æÜ„ÄÇ‰ªñÁóÖ‰∫Ü„ÄÇ
10	cook	ÁÉπÁÖÆ;ÊñôÁêÜ	[k äk]	How will you {cook} the vegetables?	‰Ω†ÊúÉÊÄéÈ∫ºÁÖÆËî¨ËèúÔºü
10	wash	Ê∏ÖÊ¥ó	[w…ë É]	I need to {wash} my hands.	ÊàëÈúÄË¶ÅÊ¥óÊâã„ÄÇ
10	temperature	Ê∫´Â∫¶	['t…õmp…ôr…ô ß]	What's the {temperature} outside?	Â§ñÈù¢ÁöÑÊ∫´Â∫¶ÊòØÂ§öÂ∞ëÔºü
10	refrigerator	ÂÜ∞ÁÆ±	[r…™'fr…™ §…ôÀåre…™t…ôr]	Put the milk back in the {refrigerator}.	Â∞áÁâõÂ•∂ÊîæÂõûÂÜ∞ÁÆ±„ÄÇ
11	pale	ËíºÁôΩÁöÑ(ËáâËâ≤ÊàñËÜöËâ≤)	[pe…™l]	Jen's face is very {pale} today.	Áèç‰ªäÂ§©ÁöÑËáâËâ≤ÂæàËíºÁôΩ„ÄÇ
11	buffet	Ëá™Âä©È§êÂª≥;Ëá™Âä©È§ê	[b…ô'fe…™]	We enjoyed a delicious breakfast {buffet}.	ÊàëÂÄë‰∫´Áî®‰∫ÜÁæéÂë≥ÁöÑËá™Âä©Êó©È§ê„ÄÇ
11	stomachache	ËÉÉÁóõ;ËÇöÂ≠êÁóõ	['st åm…ôkÀåe…™k]	Eating too much gives me a {stomachache}.	ÂêÉÂ§™Â§öËÆìÊàëËÉÉÁóõ„ÄÇ
11	lucky	Âπ∏ÈÅãÁöÑ	['l åki]	We're {lucky} that it didn't rain today.	ÊàëÂÄëÂæàÂπ∏ÈÅã‰ªäÂ§©Ê≤íÊúâ‰∏ãÈõ®„ÄÇ
11	recover	ÊÅ¢Âæ©ÂÅ•Â∫∑	[r…™'k åv…ôr]	Wendy was sick, but she {recovered}.	Ê∫´Ëø™ÁîüÁóÖ‰∫ÜÔºå‰ΩÜÂ•πÂ∫∑Âæ©‰∫Ü„ÄÇ
14	hobby	ÂóúÂ•Ω	['h…ëbi]	My favorite {hobby} is drawing.	ÊàëÊúÄÂñúÊ≠°ÁöÑÂóúÂ•ΩÊòØÁï´Áï´„ÄÇ
14	star	ÊòüÊòü	[st…ër]	Look at the {stars} in the sky!	ÁúãÁúãÂ§©‰∏äÁöÑÊòüÊòüÔºÅ
14	full	ÂÖÖÊªøÁöÑ	[f äl]	This room is {full} of people.	ÈÄôÂÄãÊàøÈñìË£°Êì†Êªø‰∫Ü‰∫∫„ÄÇ
14	billion	ÂçÅÂÑÑ	['b…™lj…ôn]	{Billions} of people live on Earth.	Êï∏ÂçÅÂÑÑ‰∫∫ÁîüÊ¥ªÂú®Âú∞ÁêÉ‰∏ä„ÄÇ
14	count	Êï∏ÁÆó	[ka änt]	Please {count} the chairs.	Ë´ãÊï∏‰∏Ä‰∏ãÊ§ÖÂ≠ê„ÄÇ
15	borrow	ÂÄüÂÖ•	['b…ëro ä]	May I {borrow} this book?	ÂèØ‰ª•ËóâÈÄôÊú¨Êõ∏ÂóéÔºü
15	interested	ÊÑüËààË∂£ÁöÑ	['…™ntr…™st…™d]	Are you {interested} in traveling?	‰Ω†ÊúâËààË∂£ÊóÖË°åÂóéÔºü
15	tip	Ë®£Á´Ö;ÊíáÊ≠•	[t…™p]	Those are great {tips}!	ÈÄô‰∫õÈÉΩÊòØÂæàÊ£íÁöÑÂª∫Ë≠∞ÔºÅ
15	cloudy	Â§öÈõ≤ÁöÑ;Èô∞Â§©ÁöÑ	['kla ädi]	Will the weather be {cloudy} tomorrow?	ÊòéÂ§©Â§©Ê∞£Â§öÈõ≤ÂóéÔºü
15	moon	Êúà‰∫Æ	[mun]	Why can't I see the {moon}?	ÁÇ∫‰ªÄÈ∫ºÊàëÁúã‰∏çÂà∞Êúà‰∫ÆÔºü
16	die	ÈÅé‰∏ñ,Ê≠ª‰∫°	[da…™]	Their pet dog {died} last month.	‰ªñÂÄëÁöÑÂØµÁâ©Áãó‰∏äÂÄãÊúàÊ≠ª‰∫Ü„ÄÇ
16	bag	Ë¢ãÂ≠ê	[b√¶g]	What's in that {bag}?	ÈÇ£ÂÄãË¢ãÂ≠êË£°Èù¢Êúâ‰ªÄÈ∫ºÔºü
16	wrong	ÈåØË™§ÁöÑ	[r…î≈ã]	You have the {wrong} idea.	‰Ω†ÁöÑÊÉ≥Ê≥ïÊòØÈåØÁöÑ„ÄÇ
16	accept	Êé•Âèó	[√¶k's…õpt]	I can't {accept} any money.	Êàë‰∏çËÉΩÊé•Âèó‰ªª‰ΩïÈáëÈå¢„ÄÇ
16	cafeteria	Âì°Â∑•/Â≠∏Ê†°È§êÂª≥	[Àåk√¶f…™'t…™ri…ô]	The boys are eating in the {cafeteria}.	Áî∑Â≠©ÂÄëÊ≠£Âú®È£üÂ†ÇÂêÉÈ£Ø„ÄÇ
17	creative	ÊúâÂâµÊÑèÁöÑ	[kriÀàe…™t…™v]	Maria is very {creative}.	Áë™È∫ó‰∫ûÂæàÊúâÂâµÊÑè„ÄÇ
17	communicate	Ê∫ùÈÄöÔºõ‰∫§ÊµÅ	[k…ôÀàmjun…™ke…™t]	Ben {communicates} with his family often.	Êú¨Á∂ìÂ∏∏ËàáÂÆ∂‰∫∫Ê∫ùÈÄö„ÄÇ
17	cellphone	ÊâãÊ©ü	[Ààs…õlfo än]	I'll call him on my {cellphone}.	ÊàëÊúÉÁî®ÊâãÊ©üÊâìÁµ¶‰ªñ„ÄÇ
17	light	ÂÖâÔºõÂÖâÁ∑ö	[la…™t]	I need more {light} so I can read.	ÊàëÈúÄË¶ÅÊõ¥Â§öÁöÑÂÖâÁ∑öÊâçËÉΩÈñ±ËÆÄ„ÄÇ
17	scientist	ÁßëÂ≠∏ÂÆ∂	[Ààsa…™…ônt…™st]	The {scientist} discovered something!	ÁßëÂ≠∏ÂÆ∂ÁôºÁèæ‰∫Ü‰ªÄÈ∫ºÔºÅ
18	microwave	ÂæÆÊ≥¢Áàê	[Ààma…™kr…ôwe…™v]	I use the {microwave} to cook fish.	ÊàëÁî®ÂæÆÊ≥¢ÁàêÁÖÆÈ≠ö„ÄÇ
18	heat up	Âä†ÁÜ±	[hit  åp]	I want to {heat up} this food.	ÊàëÊÉ≥ÊääÈÄôÈ£üÁâ©Âä†ÁÜ±‰∏Ä‰∏ã„ÄÇ
18	seat belt	ÂÆâÂÖ®Â∏∂	[sit b…õlt]	Wear your {seat belt} in the car.	Âú®ËªäÂÖßÁπ´Â•ΩÂÆâÂÖ®Â∏∂„ÄÇ
18	airplane	È£õÊ©ü	[Àà…õrple…™n]	Do you like to fly in {airplanes}?	‰Ω†ÂñúÊ≠°Êê≠È£õÊ©üÂóéÔºü
18	medicine	ÈÜ´Â≠∏ÔºõÈÜ´Ë°ì	[Ààm…õd…ôs…™n]	Justin is studying {medicine}.	Ë≥àÊñØÊ±ÄÊ≠£Âú®Â≠∏ÁøíÈÜ´Â≠∏„ÄÇ
21	clothes	Ë°£Êúç	[klo ä√∞z]	Those {clothes} are very expensive.	ÈÇ£‰∫õË°£ÊúçÂæàË≤¥„ÄÇ
21	fill	(‰Ωø)Ë£ùÊªø	[f…™l]	{Fill} all the cups with milk.	Â∞áÊâÄÊúâÊùØÂ≠êË£ùÊªøÁâõÂ•∂„ÄÇ
21	tight	Á∑äÂú∞	[ta…™t]	Pull the blanket {tight}.	ÊääÊØØÂ≠êÊãâÁ∑ä„ÄÇ
21	steam	Ëí∏Ê∞£	[stim]	The {steam} is very hot.	Ëí∏Ê±ΩÂæàÁÜ±„ÄÇ
21	wrinkle	Áö∫Ë§∂ÔºõÁö∫Á¥ã	[Ààr…™≈ãk…ôl]	There are {wrinkles} in your shirt.	‰Ω†ÁöÑË•ØË°´‰∏äÊúâÁö∫Á¥ã„ÄÇ
22	sleepy	ÁùèÂÄ¶ÁöÑÔºõÊâìÁûåÁù°ÁöÑ	[Ààslipi]	I'm {sleepy}. I can't keep my eyes open.	ÊàëÊÉ≥Áù°Ë¶∫„ÄÇÊàëÁùú‰∏çÈñãÁúºÁùõ„ÄÇ
22	ice	ÂÜ∞ÔºõÂÜ∞Â°ä	[a…™s]	I want {ice} in my water.	ÊàëÊÉ≥Âú®Ê∞¥Ë£°Âä†ÂÜ∞„ÄÇ
22	quick	Áü≠Êö´ÁöÑÔºõÂø´ÈÄüÁöÑ	[kw…™k]	Let's eat a {quick} lunch and then study.	ÊàëÂÄëÂÖàÂêÉÈ†ìÂçàÈ£ØÔºåÁÑ∂ÂæåÂÜçÂ≠∏Áøí„ÄÇ
22	wake up	Ê∏ÖÈÜí„ÄÅÈÜí‰æÜ	[Ààwe…™k  åp]	What time do you {wake up} in the morning?	‰Ω†Êó©‰∏äÂπæÈªûËµ∑Â∫äÔºü
22	energy	Á≤æÂäõ„ÄÅËÉΩÈáè	[Àà…õn…ö §i]	Her little brother has a lot of {energy}.	Â•πÁöÑÂºüÂºüÁ≤æÂäõÂÖÖÊ≤õ„ÄÇ
23	habit	ÁøíÊÖ£	[Ààh√¶b…™t]	Smoking is a very bad {habit}.	Âê∏ÁÖôÊòØ‰∏ÄÂÄãÈùûÂ∏∏‰∏çÂ•ΩÁöÑÁøíÊÖ£„ÄÇ
23	meal	‰∏ÄÈ§êÈ£Ø	[mil]	Most people eat three {meals} a day.	Â§öÊï∏‰∫∫‰∏ÄÊó•‰∏âÈ§ê„ÄÇ
23	soda	Ê±ΩÊ∞¥	[Ààso äd…ô]	I want a large {soda} with my pizza.	ÊàëÊÉ≥Ë¶Å‰∏ÄÂ§ßÊùØËòáÊâìÊ∞¥ÈÖçÊä´Ëñ©„ÄÇ
23	bedroom	Ëá•ÂÆ§	[Ààb…õdrum]	He likes to study in his {bedroom}.	‰ªñÂñúÊ≠°Âú®Ëá•ÂÆ§Ë£°Â≠∏Áøí„ÄÇ
23	video	ÂΩ±ÁâáÔºõÈåÑÂΩ±	[Ààv…™dio ä]	What kind of {videos} do you watch?	‰Ω†Áúã‰ªÄÈ∫ºÈ°ûÂûãÁöÑÂΩ±ÁâáÔºü
24	private	ÁßÅ‰∫∫ÁöÑÔºõÁßÅÊúâÁöÑ	[Ààpra…™v…™t]	This is {private} information.	ÈÄôÊòØÁßÅ‰∫∫Ë≥áË®ä„ÄÇ
24	own	Ëá™Â∑±ÁöÑ	[o än]	Having your {own} car is convenient.	ÊúâËá™Â∑±ÁöÑËªäÂæàÊñπ‰æø„ÄÇ
24	cheap	‰æøÂÆúÁöÑÔºõ‰∏çË≤¥ÁöÑ	[ ßip]	This shirt was {cheap}. It was only $10.	ÈÄô‰ª∂Ë•ØË°´Âæà‰æøÂÆú„ÄÇÊâç 10 ÁæéÂÖÉ„ÄÇ
24	individual	ÂÄã‰∫∫ÁöÑÔºõÂÄãÈ´îÁöÑ	[Àå…™nd…ôÀàv…™ §u…ôl]	I talked to each {individual} student.	ÊàëËàáÊØèÂÄãÂ≠∏ÁîüÈÄ≤Ë°å‰∫Ü‰∫§Ë´á„ÄÇ
24	slow	ÊÖ¢ÁöÑ	[slo ä]	This bus is really {slow}.	ÈÄôËºõÂÖ¨ËªäÁúüÁöÑÂæàÊÖ¢„ÄÇ
25	flow	ÊµÅÂãï	[flo ä]	I can hear water {flowing}.	ÊàëËÅΩÂà∞Ê∞¥ÊµÅÁöÑËÅ≤Èü≥„ÄÇ
25	roast	ÁÉòÁÑôÔºõÁÉ§	[ro äst]	Let's {roast} this corn.	ÊàëÂÄë‰æÜÁÉ§‰∏Ä‰∏ãÈÄôÂÄãÁéâÁ±≥Âêß„ÄÇ
25	sort	ÊåëÈÅ∏ÔºõÂàÜÈ°û	[s…îrt]	Please {sort} the paper by color.	Ë´ã‰æùÈ°èËâ≤Â∞çÁ¥ôÂºµÈÄ≤Ë°åÂàÜÈ°û„ÄÇ
25	perfect	ÂÆåÁæéÁöÑ	[Ààp…úrf…™kt]	Ed never makes mistakes. He's {perfect}.	ËâæÂæ∑Âæû‰∏çÁäØÈåØ„ÄÇ‰ªñÂæàÂÆåÁæé„ÄÇ
25	affect	ÂΩ±Èüø	[…ôÀàf…õkt]	Bright light {affects} his sleep.	Êòé‰∫ÆÁöÑÂÖâÁ∑öÂΩ±Èüø‰ªñÁöÑÁù°Áú†„ÄÇ
28	meeting	ÊúÉË≠∞ÔºõÊúÉÈù¢	[Ààmit…™≈ã]	When is your {meeting} with the boss?	‰Ω†‰ªÄÈ∫ºÊôÇÂÄôË∑üËÄÅÈóÜË¶ãÈù¢Ôºü
28	enough	Ë∂≥Â§†ÁöÑÔºõÂÖÖË∂≥ÁöÑ	[…™Ààn åf]	Do you have {enough} time?	‰Ω†ÊúâË∂≥Â§†ÁöÑÊôÇÈñìÂóéÔºü
28	moment	ÁâáÂàªÔºõÊôÇÂàª	[Ààmo äm…ônt]	Please wait a {moment}.	Ë´ãÁ®çÁ≠â„ÄÇ
28	past	ÈÅé‰∫ÜÔºõË∂ÖÈÅé(ÊôÇÈñì)	[p√¶st]	It's eight minutes {past} 9:00.	ÁèæÂú®ÊòØ 9:00 ÈÅéÂÖ´ÂàÜÈêò„ÄÇ
28	quarter	ÂçÅ‰∫îÂàÜÈêòÔºõ‰∏ÄÂàªÈêò	[Ààkw…îrt…ôr]	I can meet you in a {quarter} of an hour.	‰∏ÄÂàªÈêòÂæåÊàëÂ∞±ËÉΩË¶ãÂà∞‰Ω†„ÄÇ
29	on time	Ê∫ñÊôÇ	[…ën ta…™m]	Please be {on time} for work.	Ë´ãÊ∫ñÊôÇ‰∏äÁè≠„ÄÇ
29	popcorn	ÁàÜÁ±≥Ëä±	[Ààp…ëpk…îrn]	Nancy likes to eat {popcorn}.	ÂçóÂ∏åÂñúÊ≠°ÂêÉÁàÜÁ±≥Ëä±„ÄÇ
29	any time	‰∏çÂÆ¢Ê∞£	[Àà…õni ta…™m]	Thanks for helping me. {Any time}!	Ë¨ùË¨ù‰Ω†Âπ´Êàë„ÄÇ‰ªª‰ΩïÊôÇÈñìÔºÅ
29	make time	È®∞Âá∫ÊôÇÈñì	[me…™k ta…™m]	Please {make time} to see her.	Ë´ãÊäΩÂá∫ÊôÇÈñì‰æÜË¶ãË¶ãÂ•π„ÄÇ
29	now and then	ÂÅ∂Áàæ	[na ä √¶nd √∞…õn]	She only eats candy {now and then}.	Â•πÂè™ÊòØÂÅ∂ÁàæÂêÉÈªûÁ≥ñÊûú„ÄÇ
30	hen	ÊØçÈõû	[h…õn]	Do you get many eggs from your {hens}?	‰Ω†Âæû‰Ω†ÁöÑÊØçÈõûÈÇ£Ë£°ÂæóÂà∞ÂæàÂ§öÈõûËõãÂóéÔºü
30	farm	Ëæ≤Â†¥	[f…ërm]	What animals live on your {farm}?	ÊÇ®ÁöÑËæ≤Â†¥Ë£°ÁîüÊ¥ªËëóÂì™‰∫õÂãïÁâ©Ôºü
30	plant	Á®ÆÊ§ç	[pl√¶nt]	Help me {plant} these flowers.	Âπ´ÊàëÁ®ÆÈÄô‰∫õËä±„ÄÇ
30	golden	ÈáëËâ≤ÁöÑ	[Àà…°old…ôn]	The sun is a beautiful {golden} color.	Â§™ÈôΩÊòØÁæéÈ∫óÁöÑÈáëËâ≤„ÄÇ
30	cut	Ââ™„ÄÅÂàá	[k åt]	She {cut} some flowers in the garden.	Â•πÂú®Ëä±ÂúíË£°Ââ™‰∫Ü‰∏Ä‰∫õËä±„ÄÇ
31	pile	(‰∏Ä)Â†ÜÔºõÁñä	[pa…™l]	Is that your {pile} of clothes?	ÈÇ£ÊòØ‰Ω†ÁöÑ‰∏ÄÂ†ÜË°£ÊúçÂóéÔºü
31	mix	(‰Ωø)Ê∑∑ÂêàÔºõÊãåÂêà	[m…™ks]	{Mix} the flour and water together.	Â∞áÈ∫µÁ≤âÂíåÊ∞¥Ê∑∑ÂêàÂú®‰∏ÄËµ∑„ÄÇ
31	pan	ÁÉ§Áõ§ÔºõÂπ≥Â∫ïÈçã	[p√¶n]	Put some water in this {pan}.	Âú®ÈÄôÂÄãÈçãÂ≠êË£°Êîæ‰∏Ä‰∫õÊ∞¥„ÄÇ
31	smell	Ê∞£Âë≥	[sm…õl]	What is that terrible {smell}?	ÈÇ£ËÇ°ÂèØÊÄïÁöÑÂë≥ÈÅìÊòØ‰ªÄÈ∫ºÔºü
31	nothing	Ê≤íÊúâ‰∫ãÊÉÖÔºõÊ≤íÊúâÊù±Ë•ø	[Ààn åŒ∏…™≈ã]	{Nothing} was left after dinner.	ÊôöÈ§êÂæå‰ªÄÈ∫º‰πüÊ≤íÊúâÂâ©‰∏ã„ÄÇ
`;


    let startTime;
    let timerInterval;
    let attempts = 0;
    let correctMatches = 0;

    let words = [];
    let dates = [];
    let selectedPair = ['english', 'chinese'];
    let selectedRange = 'all';
    let currentPairs = [];
    let flippedCards = [];
    let usedWords = new Set();

    const rightSound = new Audio('right.mp3');
    const wrongSound = new Audio('wrong.mp3');


let customData = '';

function showCustomWordlist() {
    const container = document.getElementById('custom-wordlist-container');
    container.style.display = 'flex';
    renderSavedWordlists();
    
    // 
    setTimeout(() => {
        const rect = container.getBoundingClientRect();
        if (rect.height > window.innerHeight) {
            container.style.top = '5vh';
            container.style.transform = 'translateX(-50%)';
            container.style.height = '90vh';
        }
    }, 0);
}

function closeCustomWordlist() {
    document.getElementById('custom-wordlist-container').style.display = 'none';
}

function clearCustomWordlist() {
    document.getElementById('custom-wordlist').value = '';
}


function safelyGetFromStorage(key) {
    try {
        if (window.localStorage && typeof window.localStorage.getItem === 'function') {
            return window.localStorage.getItem(key);
        }
    } catch (e) {
        console.error('Error accessing localStorage:', e);
    }
    return null;
}

function safelySetToStorage(key, value) {
    try {
        if (window.localStorage && typeof window.localStorage.setItem === 'function') {
            window.localStorage.setItem(key, value);
        }
    } catch (e) {
        console.error('Error setting localStorage:', e);
    }
}

function saveCustomWordlist() {
    const wordlist = document.getElementById('custom-wordlist').value;
    if (wordlist.trim() === '') {
        alert('Ë´ãËº∏ÂÖ•Ë™ûË©ûË°®ÂÖßÂÆπ');
        return;
    }
    
    const now = new Date();
    const timestamp = now.getTime();
    const formattedDate = `${(now.getMonth() + 1).toString().padStart(2, '0')}/${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
    const wordlistName = `Ë™ûË©ûË°® ${formattedDate}`;
    
    let wordlists = [];
    const storedData = safelyGetFromStorage('wordlists');
    if (storedData) {
        wordlists = JSON.parse(storedData);
    }
    wordlists.unshift({ name: wordlistName, content: wordlist, timestamp: timestamp });
    safelySetToStorage('wordlists', JSON.stringify(wordlists));
    renderSavedWordlists();
}

function confirmCustomWordlist() {
    customData = document.getElementById('custom-wordlist').value;
    closeCustomWordlist();
    parseData();
}


function renderSavedWordlists() {
    const container = document.getElementById('saved-wordlists');
    let wordlists = [];
    const storedData = safelyGetFromStorage('wordlists');
    if (storedData) {
        wordlists = JSON.parse(storedData);
    }
    container.innerHTML = '';
    wordlists.forEach((wordlist, index) => {
        const item = document.createElement('div');
        item.className = 'wordlist-item';
        item.innerHTML = `
            <span class="wordlist-name" ondblclick="renameWordlist(${index})">${wordlist.name}</span>
            <div class="wordlist-actions">
                <button onclick="restoreWordlist(${index})">ÈÇÑÂéü</button>
                <button onclick="deleteWordlist(${index})">Âà™Èô§</button>
            </div>
        `;
        container.appendChild(item);
    });
}


function restoreWordlist(index) {
    const storedData = safelyGetFromStorage('wordlists');
    if (storedData) {
        const wordlists = JSON.parse(storedData);
        if (wordlists[index]) {
            document.getElementById('custom-wordlist').value = wordlists[index].content;
        }
    }
}

// ‰øÆÊîπ deleteWordlist ÂáΩÊï∏
function deleteWordlist(index) {
    const storedData = safelyGetFromStorage('wordlists');
    if (storedData) {
        const wordlists = JSON.parse(storedData);
        wordlists.splice(index, 1);
        safelySetToStorage('wordlists', JSON.stringify(wordlists));
        renderSavedWordlists();
    }
}

// ‰øÆÊîπ renameWordlist ÂáΩÊï∏
function renameWordlist(index) {
    const storedData = safelyGetFromStorage('wordlists');
    if (storedData) {
        const wordlists = JSON.parse(storedData);
        const newName = prompt('Ë´ãËº∏ÂÖ•Êñ∞ÁöÑË™ûË©ûË°®ÂêçÁ®±', wordlists[index].name);
        if (newName && newName.trim() !== '') {
            wordlists[index].name = newName.trim();
            safelySetToStorage('wordlists', JSON.stringify(wordlists));
            renderSavedWordlists();
        }
    }
}

// ‰øÆÊîπparseDataÂáΩÊï∏‰ª•ËôïÁêÜËá™Ë®ÇÊï∏Êìö
function parseData() {
    const dataToUse = customData || data;  // Â¶ÇÊûúÊúâËá™Ë®ÇÊï∏ÊìöÔºå‰ΩøÁî®Ëá™Ë®ÇÊï∏ÊìöÔºåÂê¶Ââá‰ΩøÁî®ÈªòË™çÊï∏Êìö
    const lines = dataToUse.trim().split('\n');
    const headers = lines[0].split('\t');
    
    // ÈáçÁΩÆÂÖ®Â±ÄËÆäÈáè
    words = [];
    dates = [];
    selectedPair = ['english', 'chinese'];  // ÈªòË™çÁÇ∫Ëã±Êñá-‰∏≠Êñá
    
    // Ê™¢Êü•Ê®ôÈ°å‰∏¶Ê±∫ÂÆöÂèØÁî®ÁöÑÈÖçÂ∞çÈÅ∏È†Ö
    const hasKK = headers.includes('KKÈü≥Ê®ô');
    const hasDate = headers.includes('Êó•Êúü');
	const hasEnglishSentence = headers.includes('Ëã±Ë™ûÂè•Â≠ê');
    
    // ÁîüÊàêÈÖçÂ∞çÈÅ∏È†ÖÊåâÈàï
    const setupDiv = document.getElementById('setup');
    const pairButtons = setupDiv.querySelector('h2:first-of-type').nextElementSibling;
    pairButtons.innerHTML = '<button id="en-ch" class="pair-button selected" onclick="selectPair(\'english\', \'chinese\')">Ëã±Ë™û - ‰∏≠Êñá</button>';
    if (hasKK) {
        pairButtons.innerHTML += '<button id="en-kk" class="pair-button" onclick="selectPair(\'english\', \'kk\')">Ëã±Ë™û - KKÈü≥Ê®ô</button>';
        pairButtons.innerHTML += '<button id="kk-ch" class="pair-button" onclick="selectPair(\'kk\', \'chinese\')">KKÈü≥Ê®ô - ‰∏≠Êñá</button>';
    }
    if (hasEnglishSentence) {
        pairButtons.innerHTML += '<button id="en-sen-ch-sen" class="pair-button" onclick="selectPair(\'englishSentence\', \'chineseSentence\')">Ëã±Ë™ûÂè•Â≠ê - ‰∏≠ÊñáÂè•Â≠ê</button>';
    }
    
    
    // ËôïÁêÜÊó•ÊúüÁØÑÂúçÈÅ∏Êìá
    const rangeSelect = document.getElementById('range-select');
    rangeSelect.innerHTML = '<option value="all">ÂÖ®ÈÉ®</option>';
    
    let currentDate = '';  // Áî®ÊñºÂ≠òÂÑ≤Áï∂ÂâçÊó•Êúü

    // Ëß£ÊûêÊï∏Êìö
  
    lines.slice(1).forEach(line => {
        const parts = line.split('\t');
        const wordObj = {};
        headers.forEach((header, index) => {
            if (header === 'Êó•Êúü' || header === 'ÂàÜÈ°û') {
                if (parts[index].trim() !== '') {
                    currentDate = parts[index];
                    if (!dates.includes(currentDate)) {
                        dates.push(currentDate);
                    }
                }
                wordObj.date = currentDate;
            } else if (header === 'Ëã±Êñá' || header === 'English' || header === 'ENGLISH' || header === 'Ëã±Ë™û') {
                wordObj.english = parts[index];
            } else if (header === 'KKÈü≥Ê®ô' || header === 'KK' || header === 'KK Èü≥Ê®ô') {
                wordObj.kk = parts[index];
            } else if (header === '‰∏≠ÊñáÈáãÁæ©' || header === '‰∏≠Êñá' || header === 'Chinese' || header === 'chinese' || header === 'ËèØË™û' ) {
                wordObj.chinese = parts[index];
            } else if (header === 'Ëã±Ë™ûÂè•Â≠ê' || header === 'English Sentence') {
                wordObj.englishSentence = parts[index];
            } else if (header === '‰∏≠ÊñáÂè•Â≠ê' || header === 'Chinese Sentence') {
                wordObj.chineseSentence = parts[index];
            }
        });
        if (wordObj.english && wordObj.chinese && wordObj.englishSentence && wordObj.chineseSentence) {
            words.push(wordObj);
        }
    });
    
    // Â¶ÇÊûúÊúâÊó•ÊúüÔºåÊ∑ªÂä†Âà∞‰∏ãÊãâÈÅ∏ÂñÆ
    if (hasDate) {
        dates.forEach(date => {
            const option = document.createElement('option');
            option.value = date;
            option.textContent = date;
            rangeSelect.appendChild(option);
        });
    } else {
        // Â¶ÇÊûúÊ≤íÊúâÊó•Êúü„ÄÅÂàÜÈ°ûÔºåÁîüÊàêÊØè10ÂÄãÂñÆË©û‰∏ÄÁµÑÁöÑÈÅ∏È†Ö
        const groups = Math.ceil(words.length / 10);
        for (let i = 0; i < groups; i++) {
            const option = document.createElement('option');
            option.value = `group${i + 1}`;
            option.textContent = `Á¨¨ ${i * 10 + 1} - ${Math.min((i + 1) * 10, words.length)} ÂÄãÂñÆË©û`;
            rangeSelect.appendChild(option);
        }
    }
}


// Ê†πÊìöÈÅ∏ÊìáÁöÑÁØÑÂúçÁç≤ÂèñÂèØÁî®ÂñÆË©û
function getAvailableWords(selectedRange) {
    if (selectedRange === 'all') {
        return words.filter(word => !usedWords.has(word.english));
    } else if (selectedRange.startsWith('group')) {
        const groupNumber = parseInt(selectedRange.slice(5)) - 1;
        const start = groupNumber * 10;
        const end = Math.min((groupNumber + 1) * 10, words.length);
        return words.slice(start, end).filter(word => !usedWords.has(word.english));
    } else {
        return words.filter(word => word.date === selectedRange && !usedWords.has(word.english));
    }
}

// Âú®È†ÅÈù¢Âä†ËºâÊôÇË™øÁî® parseData
window.onload = parseData;

    function populateDateDropdown() {
        const dropdown = document.getElementById('range-select');
        dates.forEach(date => {
            const option = document.createElement('option');
            option.value = date;
            option.textContent = date;
            dropdown.appendChild(option);
        });
    }

function selectPair(first, second) {
    selectedPair = [first, second];
    document.querySelectorAll('.pair-button').forEach(btn => btn.classList.remove('selected'));
    let buttonId;
    if (first === 'englishSentence' && second === 'chineseSentence') {
        buttonId = 'en-sen-ch-sen';
    } else {
        buttonId = `${first.slice(0,2)}-${second.slice(0,2)}`;
    }
    const selectedButton = document.getElementById(buttonId);
    if (selectedButton) {
        selectedButton.classList.add('selected');
    }
}


    function updateSelectedRange() {
        selectedRange = document.getElementById('range-select').value;
    }

function startGame() {
    document.getElementById('setup').style.display = 'none';
    document.getElementById('game-board').style.display = 'grid';
    document.getElementById('game-controls').style.display = 'none';
    document.getElementById('return-button').style.display = 'block';
    document.getElementById('stats').style.display = 'none';
    document.getElementById('show-custom-wordlist-btn').style.display = 'none';

    startTime = new Date();
    timerInterval = setInterval(updateTimer, 1000);
    attempts = 0;
    correctMatches = 0;

    let availableWords = getAvailableWords(selectedRange);

    if (availableWords.length < 6) {
        usedWords.clear();
        availableWords = getAvailableWords(selectedRange);
    }
    
    currentPairs = shuffleArray(availableWords).slice(0, 6);
    currentPairs.forEach(word => {
        usedWords.add(word.english);
        // Â¶ÇÊûúÈÅ∏Êìá‰∫ÜÂè•Â≠êÈÖçÂ∞çÔºå‰πüÂ∞áÂè•Â≠êÂä†ÂÖ•Â∑≤‰ΩøÁî®ÂàóË°®
        if (selectedPair[0] === 'englishSentence' || selectedPair[1] === 'chineseSentence') {
            usedWords.add(word.englishSentence);
        }
    });
    renderBoard();
}

let spellingRound = 1;
let spellingWords = [];

function startSpellingGame() {
	usedWords.clear();
    document.getElementById('setup').style.display = 'none';
    document.getElementById('game-board').style.display = 'flex';
    document.getElementById('game-controls').style.display = 'none';
    document.getElementById('return-button').style.display = 'block';
    document.getElementById('stats').style.display = 'none';
    document.getElementById('show-custom-wordlist-btn').style.display = 'none';

    startTime = new Date();
    timerInterval = setInterval(updateTimer, 1000);
    attempts = 0;
    correctMatches = 0;

    spellingRound = 1;
    spellingWords = shuffleArray(getAvailableWords(selectedRange)).slice(0, 5);
    spellingWords.forEach(word => usedWords.add(word.english));

    renderSpellingGame();
}

function renderSpellingGame() {
    const gameBoard = document.getElementById('game-board');
    gameBoard.innerHTML = '';
    if (spellingRound <= 5) {
        const currentSpellingWord = spellingWords[spellingRound - 1];
        
        // ÂéüÊúâÁöÑË©ûË™ûÈ°ØÁ§∫
        const wordDisplay = document.createElement('div');
        wordDisplay.className = 'word-display';
        wordDisplay.innerHTML = selectedPair[1] === 'chinese' ? currentSpellingWord.chinese : colorizeKKPhonetic(currentSpellingWord.kk);
        gameBoard.appendChild(wordDisplay);

        // Êñ∞Â¢û: È°ØÁ§∫‰∏≠ÊñáÂè•Â≠ê
        if (currentSpellingWord.chineseSentence) {
            const chineseSentenceDisplay = document.createElement('div');
            chineseSentenceDisplay.className = 'sentence-display';
            chineseSentenceDisplay.textContent = currentSpellingWord.chineseSentence;
            gameBoard.appendChild(chineseSentenceDisplay);
        }

        // Êñ∞Â¢û: È°ØÁ§∫Ëã±Ë™ûÂè•Â≠êÔºåÂ∞áÁõÆÊ®ôË©ûÊõøÊèõÁÇ∫‰∏ãÂäÉÁ∑ö
        if (currentSpellingWord.englishSentence) {
            const englishSentenceDisplay = document.createElement('div');
            englishSentenceDisplay.className = 'sentence-display';
            const replacedEnglishSentence = currentSpellingWord.englishSentence.replace(
                new RegExp(`\\b${currentSpellingWord.english}\\b`, 'gi'),
                '_'.repeat(currentSpellingWord.english.length)
            );
            englishSentenceDisplay.textContent = replacedEnglishSentence;
            gameBoard.appendChild(englishSentenceDisplay);
            // ÊúóËÆÄÂÆåÊï¥ÁöÑËã±Ë™ûÂè•Â≠ê
            setTimeout(() => {
                speakWord(currentSpellingWord.englishSentence);
            }, 500); // Âª∂ÈÅ≤ÂçäÁßíÈêòÂÜçÊúóËÆÄÔºåÁ¢∫‰øùÈ†ÅÈù¢Â∑≤Á∂ìÊ∏≤ÊüìÂÆåÊàê
        }

        // ÂéüÊúâÁöÑËº∏ÂÖ•Ê°Ü
        const input = document.createElement('input');
        input.type = 'text';
        // ÂâµÂª∫‰Ωî‰ΩçÁ¨¶ÊñáÂ≠ó
        const answerWord = currentSpellingWord.english;
        const placeholderText = answerWord.split('').map((char, index) => {
            if (index === 0) return char;
            if (char === ' ') return ' ';
            if (char === '-') return '-';
            return '*';
        }).join('');
        input.placeholder = placeholderText;
        input.addEventListener('keyup', (e) => checkSpellingAnswer(e, currentSpellingWord));
        input.onfocus = () => input.select();
        gameBoard.appendChild(input);
        input.focus();
        spellingRound++;
    } else {
        showSpellingResults();
    }
}

function showSpellingResults() {
    const now = new Date();
    const diff = now - startTime;
    const seconds = Math.floor((diff % 60000) / 1000);
    const accuracy = Math.round((correctMatches / attempts) * 100);

    const statsDiv = document.createElement('div');
    statsDiv.className = 'stats-display';
    statsDiv.innerHTML = `
        <h2>ÂõûÂêàÁµêÊùü</h2>
        <p>Áî®ÊôÇ: ${seconds}Áßí</p>
        <p>Ê≠£Á¢∫Áéá: ${accuracy}%</p>
    `;

    const continueButton = document.createElement('button');
    continueButton.textContent = 'ÁπºÁ∫å';
    continueButton.onclick = startSpellingGame;

    const returnButton = document.createElement('button');
    returnButton.textContent = 'ËøîÂõû';
    returnButton.onclick = returnToSetup;

    const gameBoard = document.getElementById('game-board');
    gameBoard.innerHTML = '';
    gameBoard.appendChild(statsDiv);
    gameBoard.appendChild(continueButton);
    gameBoard.appendChild(returnButton);

    clearInterval(timerInterval);
}

function checkSpellingAnswer(e, word) {
    if (e.key === 'Enter') {
        const userInput = e.target.value.toLowerCase().trim();
        const correctWord = word.english.toLowerCase().trim();

		if (userInput === correctWord) {
			
            rightSound.play();
            correctMatches++;
            attempts++;         
            setTimeout(() => {
			   e.target.value = '';
			   
               renderSpellingGame();
               e.target.focus();
            }, 10);
        } else {
            wrongSound.play();
            attempts++;
			speakWord(word.english);
			e.target.classList.add('shake');

            // Âú®Ëº∏ÂÖ•Ê°Ü‰∏ãÊñπÈ°ØÁ§∫Ê≠£Á¢∫Á≠îÊ°à
            const inputContainer = e.target.parentElement;
            const correctAnswerElement = document.createElement('div');
            //correctAnswerElement.textContent = `‚ú® ${word.english}`;
			correctAnswerElement.innerHTML = `‚ú® ${colorizeEnglishWord(word.english)} ‚ú®`;
			
			correctAnswerElement.className = 'correctAnswerElement';
            inputContainer.appendChild(correctAnswerElement);
			

            // Ê∏ÖÈô§Ê≠£Á¢∫Á≠îÊ°àÊèêÁ§∫‰∏¶ËÆì‰ΩøÁî®ËÄÖÈáçÊñ∞Ëº∏ÂÖ•
            setTimeout(() => {
                correctAnswerElement.remove();
                e.target.value = '';
                e.target.focus();
            }, 2000);
        }
    }
}





function updateStats() {
    const accuracy = Math.round((correctMatches / attempts) * 100);
    document.getElementById('accuracy').textContent = `${accuracy}%`;
}


    function updateTimer() {
        const now = new Date();
        const diff = now - startTime;
        const minutes = Math.floor(diff / 60000);
        const seconds = Math.floor((diff % 60000) / 1000);
        document.getElementById('time').textContent = 
            `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function colorizeEnglishWord(word) {
        const vowels = ['a', 'e', 'i', 'o', 'u'];
        const semivowels = ['w', 'y'];
        return word.split('').map(char => {
            if (vowels.includes(char.toLowerCase())) {
                return `<span class="vowel">${char}</span>`;
            } else if (semivowels.includes(char.toLowerCase())) {
                return `<span class="semivowel">${char}</span>`;
            } else {
                return `<span class="consonant">${char}</span>`;
            }
        }).join('');
    }


	function colorizeKKPhonetic(kk) {
		const vowels = ['a', '…ë', '√¶', '…õ', 'e', '…™', 'i', '…î', 'o', ' ä', 'u', ' å', '…ô', '…ö', '…ù'];
		const semivowels = ['j', 'w'];
		const specialChars = [',', "'", ' '];

		return kk.split('').map(char => {
			if (vowels.includes(char)) {
				return `<span class="vowel">${char}</span>`;
			} else if (semivowels.includes(char)) {
				return `<span class="semivowel">${char}</span>`;
			} else if (char === '[' || char === ']') {
				return `<span class="kk-bracket">${char}</span>`;
			} else if (!specialChars.includes(char)) {
				return `<span class="consonant">${char}</span>`;
			}
			return char;
		}).join('');
	}

function renderBoard() {
    const gameBoard = document.getElementById('game-board');
    gameBoard.innerHTML = '';
    const allCards = [...currentPairs.map(word => ({ word, type: selectedPair[0] })), 
                      ...currentPairs.map(word => ({ word, type: selectedPair[1] }))];
    const shuffledCards = shuffleArray(allCards);
    shuffledCards.forEach((card, index) => {
        const cardElement = document.createElement('div');
        cardElement.className = 'card';
        if (card.type === 'english') {
            cardElement.innerHTML = colorizeEnglishWord(card.word[card.type]);
        } else if (card.type === 'kk' && selectedPair.includes('kk') && selectedPair.includes('chinese')) {
            cardElement.innerHTML = colorizeKKPhonetic(card.word[card.type]);
        } else if (card.type === 'englishSentence' || card.type === 'chineseSentence') {
			// ËôïÁêÜËã±Ë™ûÂè•Â≠êÂíå‰∏≠ÊñáÂè•Â≠ê
            cardElement.textContent = card.word[card.type];
        } else {
            cardElement.textContent = card.word[card.type];
        }
        cardElement.dataset.index = index;
        cardElement.onclick = () => {
            flipCard(cardElement, card);
            // Áï∂ÈªûÊìäËã±Ë™ûÂè•Â≠êÂç°ÁâáÊôÇÊí≠ÊîæÈü≥È†ª
            if (card.type === 'englishSentence') {
                speakWord(card.word.englishSentence);
            }
        };
        gameBoard.appendChild(cardElement);
    });
}

    function flipCard(cardElement, card) {
        if (flippedCards.length < 2 && !flippedCards.some(fc => fc.element === cardElement) && !cardElement.classList.contains('matched')) {
            cardElement.classList.add('flipped');
            flippedCards.push({ element: cardElement, card: card });
            
            if (card.type === 'english') {
                speakWord(card.word.english);
            }
            
            if (flippedCards.length === 2) {
                setTimeout(checkMatch, 10);
            }
        }
    }
    function checkMatch() {
        const [card1, card2] = flippedCards;
        attempts++;
        if (card1.card.word === card2.card.word && card1.card.type !== card2.card.type) {
            card1.element.classList.add('matched', 'jump');
            card2.element.classList.add('matched', 'jump');

        if (selectedPair[0] === 'englishSentence' && selectedPair[1] === 'chineseSentence') {
            speakWord(card1.card.word.englishSentence);
        } else {
            speakWord(card1.card.word.english);
        }
        
        rightSound.play();
        correctMatches++;

            // ÁßªÈô§Ë∑≥ÂãïÂãïÁï´È°ûÂà•
            setTimeout(() => {
                card1.element.classList.remove('jump');
                card2.element.classList.remove('jump');
            }, 300);
        } else {
            card1.element.classList.add('shake');
            card2.element.classList.add('shake');
            wrongSound.play();

            // ÁßªÈô§ÊôÉÂãïÂãïÁï´È°ûÂà•‰∏¶ÁøªÂõûÂç°Áâá
            setTimeout(() => {
                card1.element.classList.remove('shake', 'flipped');
                card2.element.classList.remove('shake', 'flipped');
            }, 300);
        }
        flippedCards = [];

        if (document.querySelectorAll('.card:not(.matched)').length === 0) {
            clearInterval(timerInterval);
            showStats();
            setTimeout(showGameControls, 10);
        }
    }


    function showStats() {
        const accuracy = Math.round((correctMatches / attempts) * 100);
        document.getElementById('accuracy').textContent = `${accuracy}%`;
        document.getElementById('stats').style.display = 'block';
    }

    function showGameControls() {
        document.getElementById('game-controls').style.display = 'block';
    }

	let currentUtterance = null;

	function speakWord(word) {
		// Â¶ÇÊûúÊúâÊ≠£Âú®Êí≠ÊîæÁöÑË™ûÈü≥ÔºåÂÖàÂÅúÊ≠¢ÂÆÉ;
		if (currentUtterance) {
			window.speechSynthesis.cancel();
		}

		// ÂâµÂª∫Êñ∞ÁöÑË™ûÈü≥
		const utterance = new SpeechSynthesisUtterance(word);
		utterance.lang = 'en-US';

		// ‰øùÂ≠òÁï∂ÂâçË™ûÈü≥ÂºïÁî®
		currentUtterance = utterance;

		// Êí≠ÊîæÊñ∞Ë™ûÈü≥
		window.speechSynthesis.speak(utterance);

		// Ë™ûÈü≥ÁµêÊùüÂæåÊ∏ÖÈô§ÂºïÁî®
		utterance.onend = () => {
			currentUtterance = null;
		};
	}

    function continueGame() {
        document.getElementById('game-controls').style.display = 'none';
        startGame();
    }

	function returnToSetup() {
		document.getElementById('game-board').style.display = 'none';
		document.getElementById('game-controls').style.display = 'none';
		document.getElementById('setup').style.display = 'block';
		document.getElementById('return-button').style.display = 'none';
		document.getElementById('stats').style.display = 'none';
		document.getElementById('show-custom-wordlist-btn').style.display = 'inline-block';
		clearInterval(timerInterval);
		usedWords.clear();
	}

function showWordList() {
    const modal = document.getElementById('word-list-modal');
    const tableBody = document.querySelector('#word-list-table tbody');
    const tableHead = document.querySelector('#word-list-table thead');
    tableBody.innerHTML = '';
    tableHead.innerHTML = '';

    // Áç≤ÂèñÊï∏ÊìöÁöÑÊ®ôÈ°åË°å
    const headers = customData ? customData.trim().split('\n')[0].split('\t') : data.trim().split('\n')[0].split('\t');

    // ÂâµÂª∫Ë°®È†≠
    const headerRow = tableHead.insertRow();
    headers.forEach(header => {
        const th = document.createElement('th');
        th.textContent = header;
        th.dataset.header = header;
        headerRow.appendChild(th);
    });

    // ÊéßÂà∂Âàó
    let checkboxContainer = document.getElementById('column-checkboxes');
    if (!checkboxContainer) {
        checkboxContainer = document.createElement('div');
        checkboxContainer.id = 'column-checkboxes';
        checkboxContainer.style.marginBottom = '10px';
        headers.forEach((header, index) => {
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = `checkbox-${header}`;
            checkbox.checked = true;
            checkbox.onchange = () => updateTableVisibility();
            const label = document.createElement('label');
            label.htmlFor = `checkbox-${header}`;
            label.textContent = header;
            checkboxContainer.appendChild(checkbox);
            checkboxContainer.appendChild(label);
        });
        // Â∞áÊéßÂà∂ÂàóÊèíÂÖ•Âà∞Ë°®Ê†º‰πãÂâçÔºåÊ®ôÈ°å‰πãÂæå
        modal.querySelector('.modal-content').insertBefore(checkboxContainer, document.getElementById('word-list-table'));
    }

    let wordsToShow = selectedRange === 'all' ? words : getAvailableWords(selectedRange);
    wordsToShow.forEach(word => {
        const row = tableBody.insertRow();
        headers.forEach(header => {
            const cell = row.insertCell();
            cell.dataset.header = header;
            let content = '';
            // Ê†πÊìö‰∏çÂêåÁöÑÂèØËÉΩÁöÑÊ®ôÈ°åÂêçÁ®±‰æÜÁç≤ÂèñÂÖßÂÆπ
            if (header === 'Êó•Êúü' || header === 'ÂàÜÈ°û') content = word.date;
            else if (header === 'Ëã±Êñá' || header === 'English' || header === 'ENGLISH' || header === 'Ëã±Ë™û') content = word.english;
            else if (header === 'KKÈü≥Ê®ô' || header === 'KK' || header === 'KK Èü≥Ê®ô') content = word.kk;
            else if (header === '‰∏≠ÊñáÈáãÁæ©' || header === '‰∏≠Êñá' || header === 'Chinese' || header === 'chinese' || header === 'ËèØË™û') content = word.chinese;
            else if (header === 'Ëã±Ë™ûÂè•Â≠ê' || header === 'English Sentence') content = word.englishSentence;
            else if (header === '‰∏≠ÊñáÂè•Â≠ê' || header === 'Chinese Sentence') content = word.chineseSentence;
            else content = word[header.toLowerCase()] || ''; // for any other headers

			  if (header === 'Ëã±Êñá' || header === 'English' || header === 'ENGLISH' || header === 'Ëã±Ë™û') {
				cell.innerHTML = colorizeEnglishWord(content);
				cell.className = 'clickable';
				cell.onclick = () => speakWord(content);
			  } else if (header === 'KKÈü≥Ê®ô' || header === 'KK' || header === 'KK Èü≥Ê®ô') {
				cell.innerHTML = colorizeKKPhonetic(content);
				cell.className = 'clickable';
				cell.onclick = () => speakWord(word.english);
			  } else if (header === 'Ëã±Ë™ûÂè•Â≠ê' || header === 'English Sentence') {
				cell.textContent = content;
				cell.className = 'clickable';
				cell.onclick = () => speakWord(content);
            } else {
                cell.textContent = content;
            }
        });
    });

    updateTableVisibility();
    modal.style.display = 'block';
}

function updateTableVisibility() {
    const headers = document.querySelectorAll('#word-list-table th');
    const rows = document.querySelectorAll('#word-list-table tbody tr');

    headers.forEach((header, index) => {
        const isChecked = document.getElementById(`checkbox-${header.dataset.header}`).checked;
        header.style.display = isChecked ? '' : 'none';
        rows.forEach(row => {
            row.cells[index].style.display = isChecked ? '' : 'none';
        });
    });
}

function closeWordList() {
    const modal = document.getElementById('word-list-modal');
    modal.style.display = 'none';
}

// Áï∂Áî®Êà∂ÈªûÊìäÊ®°ÊÖãÊ°ÜÂ§ñÈÉ®ÊôÇÈóúÈñâÊ®°ÊÖãÊ°Ü
window.onclick = function(event) {
    const modal = document.getElementById('word-list-modal');
    if (event.target == modal) {
        modal.style.display = 'none';
    }
}

// Êõ¥Êñ∞ updateSelectedRange ÂáΩÊï∏‰ª•Âú®ÁØÑÂúçÊîπËÆäÊôÇÂà∑Êñ∞Ë©ûË°®
function updateSelectedRange() {
    selectedRange = document.getElementById('range-select').value;
    if (document.getElementById('word-list-modal').style.display === 'block') {
        showWordList(); // Â¶ÇÊûúË©ûË°®Ê≠£Âú®È°ØÁ§∫ÔºåÂâáÂà∑Êñ∞ÂÆÉ
    }
}

    // ÂàùÂßãÂåñ
	parseData();
	populateDateDropdown();
	document.getElementById('show-custom-wordlist-btn').onclick = showCustomWordlist;








let currentGameSentences = [];
let currentSentenceIndex = 0;
let currentWords = [];
let correctAnswers = 0;
let lastCheckedAnswer = '';
let canCheck = true;
let gameWordAudio = null;
let isMuted = false;

function startSentenceGame() {
    // Áç≤ÂèñÁï∂ÂâçÈÖçÂ∞çÊ®°Âºè
    const pairButtons = document.querySelectorAll('.pair-button');
    const selectedPairButton = Array.from(pairButtons).find(btn => btn.classList.contains('selected'));
    const selectedPairId = selectedPairButton.id;
    
    // Èö±ËóèË®≠ÁΩÆÁïåÈù¢ÔºåÈ°ØÁ§∫ÈÅäÊà≤ÁïåÈù¢
    document.getElementById('setup').style.display = 'none';
    const gameContainer = document.getElementById('gameContainer');
    gameContainer.style.display = 'block';
	const gameContent = document.querySelector('.game-content');
	gameContent.style.display = 'block';
    
    // Ê†πÊìöÈÅ∏ÊìáÁöÑÈÖçÂ∞çÊ®°ÂºèÊ∫ñÂÇôÈ°åÁõÆ
    currentGameSentences = [];
    let availableWords = getAvailableWords(selectedRange);
    
    availableWords.forEach(word => {
        let question, answer;
        switch(selectedPairId) {
            case 'en-ch':
                question = word.chinese;
                answer = word.english;
                break;
            case 'en-kk':
                question = word.kk;
                answer = word.english;
                break;
            case 'kk-ch':
                question = word.chinese;
                answer = word.kk;
                break;
            case 'en-sen-ch-sen':
                question = word.chineseSentence;
                answer = word.englishSentence;
                break;
        }
        
        currentGameSentences.push({
            primary: answer,
            secondary: question
        });
    });
    
    // Êâì‰∫ÇÈ°åÁõÆÈ†ÜÂ∫è
    shuffleArray2(currentGameSentences);
    
    // ÈñãÂßãÁ¨¨‰∏ÄÈ°å
    currentSentenceIndex = 0;
    correctAnswers = 0;
    loadNextSentence();
}




function shuffleArray2(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}



function playAudioMp3(filename) {
  const audio = new Audio(filename);
  audio.play();
}


function nextQuestion() {
  currentSentenceIndex++;
  loadNextSentence();
}

function nextQuestion2() {
	document.getElementById('gameResult').style.display = 'none';	
	document.getElementById('gameContent').style.display = 'block';	
	document.getElementById('gameContainer').style.display = 'block';	
  currentSentenceIndex++;
  loadNextSentence();
}

function closeGame() {
    document.getElementById('gameContainer').style.display = 'none';
	document.getElementById('gameResult').style.display = 'none';	
	//document.getElementById('controls').style.display = 'block';
	//document.getElementById('content').style.display = 'block';
	document.getElementById('setup').style.display = 'block';

    currentSentenceIndex = 0;
    correctAnswers = 0;
    if (gameWordAudio) {
        gameWordAudio.pause();
        gameWordAudio = null;
    }
}




function updateProgressBar() {
  const progressBarFill = document.querySelector('.progress-bar-fill');
  const progressText = document.querySelector('.progress-text');
  const progress = ((currentSentenceIndex + 1) / currentGameSentences.length) * 100;
  
  progressBarFill.style.width = `${progress}%`;
  progressText.textContent = `${currentSentenceIndex + 1} / ${currentGameSentences.length}`;
}

function showGameResult() {
  const gameContent = document.querySelector('.game-content');
  const gameResult = document.getElementById('gameResult');
  const accuracyRate = document.getElementById('accuracyRate');
  
  gameContent.style.display = 'none';
  gameResult.style.display = 'block';  
  
  const accuracy = (correctAnswers / currentGameSentences.length) * 100;
  accuracyRate.textContent = `${accuracy.toFixed(1)}%`;
}

function endGame() {
  //showGameResult();
  closeGame();
}


function restartGame() {
    const gameContent = document.querySelector('.game-content');
    const gameResult = document.getElementById('gameResult');
    gameContent.style.display = 'block';
    gameResult.style.display = 'none';
	document.getElementById('gameResult').style.display = 'none';
    if (gameWordAudio) {
        gameWordAudio.pause();
        gameWordAudio = null;
    }
    startSentenceGame();
}


function loadNextSentence() {
  if (currentSentenceIndex >= currentGameSentences.length) {
    showGameResult();
    return;
  }
  
  const sentence = currentGameSentences[currentSentenceIndex];
  document.getElementById('gameQuestion').textContent = sentence.secondary;
  currentWords = sentence.primary.split(' ');
  shuffleArray(currentWords);
  
  const wordBank = document.getElementById('wordBank');
  const answerArea = document.getElementById('answerArea');
  wordBank.innerHTML = '';
  answerArea.innerHTML = '';
  
  currentWords.forEach((word, index) => {
    const wordTile = createWordTile(word, index);
    wordBank.appendChild(wordTile);
  });
  
  document.getElementById('checkButton').style.display = 'inline-block';
  document.getElementById('nextButton').style.display = 'none';
  document.getElementById('nextButton2').style.display = 'none';
  document.getElementById('endGameButton').style.display = 'none';
  lastCheckedAnswer = '';
  canCheck = true;
  updateCheckButtonState();
  updateProgressBar();
  
  setTimeout(() => {
    playGameAudio();
  }, 500);
}


// ‰øÆÊîπ createWordTile ÂáΩÊï∏,ÈÖçÂêà‰∏ªÁ®ãÂºèÁöÑÈü≥Ë®äÊí≠ÊîæÈÇèËºØ
function createWordTile(word, index) {
    const tile = document.createElement('div');
    tile.className = 'word-tile';
    tile.textContent = word;
    tile.dataset.index = index;

    // Áç≤ÂèñÁï∂ÂâçÁöÑÈÖçÂ∞çÊ®°Âºè
    const pairButtons = document.querySelectorAll('.pair-button');
    const selectedPairButton = Array.from(pairButtons).find(btn => btn.classList.contains('selected'));
    const selectedPairId = selectedPairButton.id;
    
    // Ë®≠ÁΩÆÈªûÊìä‰∫ã‰ª∂
    tile.onclick = function() {
        moveWord(this);
        // Ê†πÊìöÈÖçÂ∞çÊ®°ÂºèÊ±∫ÂÆöÊí≠ÊîæÁöÑË™ûË®Ä
        let audioLang;
        switch(selectedPairId) {
            case 'en-ch':
            case 'en-kk':
                audioLang = 'english';
                break;
            case 'kk-ch':
                // KKÈü≥Ê®ôÊ®°Âºè‰∏ãÊí≠ÊîæËã±ÊñáÈü≥Ê™î
                audioLang = 'english';
                // ÊâæÂà∞Â∞çÊáâÁöÑËã±ÊñáÂñÆÂ≠ó
                const currentWord = words.find(w => w.kk === word);
                if (currentWord) {
                    word = currentWord.english;
                }
                break;
            case 'en-sen-ch-sen':
                audioLang = 'english';
                break;
        }
        
        // Ë™øÁî®‰∏ªÁ®ãÂºèÁöÑÁôºÈü≥ÂäüËÉΩ
        if (word && audioLang) {
            speakWord(word);
        }
    };
    
    return tile;
}

// ‰øÆÊîπ playGameAudio ÂáΩÊï∏,ÈÖçÂêà‰∏ªÁ®ãÂºèÁöÑÈü≥Ë®äÊí≠ÊîæÈÇèËºØ
function playGameAudio() {
    if (isMuted) return;

    // Áç≤ÂèñÁï∂ÂâçÁöÑÈÖçÂ∞çÊ®°Âºè
    const pairButtons = document.querySelectorAll('.pair-button');
    const selectedPairButton = Array.from(pairButtons).find(btn => btn.classList.contains('selected'));
    const selectedPairId = selectedPairButton.id;

    // Áç≤ÂèñÁï∂ÂâçÈ°åÁõÆÁöÑÁ≠îÊ°à
    const currentSentence = currentGameSentences[currentSentenceIndex];
    let textToSpeak = currentSentence.primary; // È†êË®≠Êí≠ÊîæÁ≠îÊ°à

    // Â¶ÇÊûúÊòØ KK Èü≥Ê®ôÊ®°Âºè,ÈúÄË¶ÅÊâæÂà∞Â∞çÊáâÁöÑËã±ÊñáÂñÆÂ≠ó
    if (selectedPairId === 'kk-ch') {
        const currentWord = words.find(w => w.kk === textToSpeak);
        if (currentWord) {
            textToSpeak = currentWord.english;
        }
    }

    // ‰ΩøÁî®‰∏ªÁ®ãÂºèÁöÑÁôºÈü≥ÂäüËÉΩ
    if (textToSpeak) {
        // Ê∏ÖÈô§‰πãÂâçÁöÑÈü≥Ë®ä
        if (window.speechSynthesis.speaking) {
            window.speechSynthesis.cancel();
        }
        speakWord(textToSpeak);
    }
}

function playGameAudioWordBank(text) {
    if (isMuted) return;

    // Áç≤ÂèñÁï∂ÂâçÁöÑÈÖçÂ∞çÊ®°Âºè
    const pairButtons = document.querySelectorAll('.pair-button');
    const selectedPairButton = Array.from(pairButtons).find(btn => btn.classList.contains('selected'));
    const selectedPairId = selectedPairButton.id;

    // Áç≤ÂèñÁï∂ÂâçÈ°åÁõÆÁöÑÁ≠îÊ°à
    const currentSentence = currentGameSentences[currentSentenceIndex];
    let textToSpeak = text; // È†êË®≠Êí≠ÊîæÁ≠îÊ°à

    // Â¶ÇÊûúÊòØ KK Èü≥Ê®ôÊ®°Âºè,ÈúÄË¶ÅÊâæÂà∞Â∞çÊáâÁöÑËã±ÊñáÂñÆÂ≠ó
    if (selectedPairId === 'kk-ch') {
        const currentWord = words.find(w => w.kk === textToSpeak);
        if (currentWord) {
            textToSpeak = currentWord.english;
        }
    }

    // ‰ΩøÁî®‰∏ªÁ®ãÂºèÁöÑÁôºÈü≥ÂäüËÉΩ
    if (textToSpeak) {
        // Ê∏ÖÈô§‰πãÂâçÁöÑÈü≥Ë®ä
        if (window.speechSynthesis.speaking) {
            window.speechSynthesis.cancel();
        }
        speakWord(textToSpeak);
    }
}

// ËºîÂä©ÂáΩÊï∏: ÁßªÂãïÂñÆË©ûÁ£öÂ°ä
function moveWord(tile) {
    const answerArea = document.getElementById('answerArea');
    const wordBank = document.getElementById('wordBank');

    if (tile.parentNode === wordBank) {
        // Â∞áÁ£öÂ°äÁßªÂãïÂà∞Á≠îÊ°àÂçÄÂüü
        const clonedTile = tile.cloneNode(true);
        clonedTile.onclick = function() { moveWord(this); };
        answerArea.appendChild(clonedTile);
        tile.style.opacity = '0.5';
        tile.style.backgroundColor = '#f0f0f0';
        tile.onclick = null;
    } else if (tile.parentNode === answerArea) {
        // Â∞áÁ£öÂ°äÁßªÂõûÂñÆË©ûÂ∫´
        tile.remove();
        const originalTile = wordBank.querySelector(`[data-index="${tile.dataset.index}"]`);
        if (originalTile) {
            originalTile.style.opacity = '1';
            originalTile.style.backgroundColor = '#fff';
            originalTile.onclick = function() { 
                moveWord(this);
                speakWord(this.textContent); // Êí≠ÊîæÂñÆÂÄãÂñÆË©ûÁöÑÈü≥Ê™î
            };
        }
    }

    updateCheckButtonState();
}

// Êõ¥Êñ∞Ê™¢Êü•ÊåâÈàïÁãÄÊÖã
function updateCheckButtonState() {
    const answerArea = document.getElementById('answerArea');
    const currentAnswer = Array.from(answerArea.children)
                              .map(tile => tile.textContent)
                              .join(' ');
    const checkButton = document.getElementById('checkButton');
    
    if (currentAnswer !== lastCheckedAnswer && currentAnswer.trim() !== '') {
        checkButton.disabled = false;
        checkButton.style.opacity = '1';
    } else {
        checkButton.disabled = true;
        checkButton.style.opacity = '0.5';
    }
}



function toggleMute() {
    isMuted = !isMuted;
    const muteButton = document.getElementById('muteButton');
    muteButton.textContent = isMuted ? 'üîá' : 'üîä';
    
    // Â¶ÇÊûúÊ≠£Âú®Êí≠ÊîæÈü≥È†ªÔºåÊ†πÊìöÈùúÈü≥ÁãÄÊÖãÊö´ÂÅúÊàñÁπºÁ∫åÊí≠Êîæ
    if (gameWordAudio) {
        if (isMuted) {
            gameWordAudio.pause();
        } else {
            gameWordAudio.play();
        }
    }
}



function moveWord(tile) {
    const answerArea = document.getElementById('answerArea');
    const wordBank = document.getElementById('wordBank');

    if (tile.parentNode === wordBank) {
        // Â∞áÁ£öÂ°äÁßªÂãïÂà∞Á≠îÊ°àÂçÄÂüü
        const clonedTile = tile.cloneNode(true);
        clonedTile.onclick = function() { moveWord(this); };
        answerArea.appendChild(clonedTile);
        tile.style.opacity = '0.5';
        tile.style.backgroundColor = '#f0f0f0';
        tile.onclick = null;
    } else if (tile.parentNode === answerArea) {
        // Â∞áÁ£öÂ°äÁßªÂõûÂñÆË©ûÂ∫´
        tile.remove();
        const originalTile = wordBank.querySelector(`[data-index="${tile.dataset.index}"]`);
        if (originalTile) {
            originalTile.style.opacity = '1';
            originalTile.style.backgroundColor = '#fff';
            originalTile.onclick = function() { 
                moveWord(this);
                playGameAudioWordBank(this.textContent); // ‰ΩøÁî®ÁèæÊúâÁöÑÈü≥Ë®äÊí≠ÊîæÂáΩÊï∏
            };
        }
    }

    updateCheckButtonState();
}


function updateCheckButtonState() {
  const answerArea = document.getElementById('answerArea');
  const currentAnswer = Array.from(answerArea.children).map(tile => tile.textContent).join(' ');
  const checkButton = document.getElementById('checkButton');

  if (currentAnswer !== lastCheckedAnswer && currentAnswer.trim() !== '') {
    checkButton.disabled = false;
    checkButton.style.opacity = '1';
  } else {
    checkButton.disabled = true;
    checkButton.style.opacity = '0.5';
  }
}



function checkAnswer() {
  if (!canCheck) return;

  const answerArea = document.getElementById('answerArea');
  const userAnswer = Array.from(answerArea.children).map(tile => tile.textContent).join(' ');
  const correctAnswer = currentGameSentences[currentSentenceIndex].primary;

  lastCheckedAnswer = userAnswer;
  canCheck = false;

  const answerTiles = answerArea.querySelectorAll('.word-tile');

  if (userAnswer === correctAnswer) {
    playAudioMp3('right.mp3');
    answerTiles.forEach(tile => {
      tile.classList.add('jump');
      setTimeout(() => tile.classList.remove('jump'), 300);
    });
    document.getElementById('checkButton').style.display = 'none';
    document.getElementById('nextButton').style.display = 'inline-block';
	document.getElementById('nextButton2').style.display = 'inline-block';
	// if(currentGameSentences.length >=10 && currentSentenceIndex >= 1){
	//    document.getElementById('endGameButton').style.display = 'block'; //Áï∂Á∏ΩÈ°åÊï∏Ë∂ÖÈÅé10È°åÊâçÈ°ØÁ§∫;
	//  }

	correctAnswers++;
  } else {
    playAudioMp3('wrong.mp3');
    answerTiles.forEach(tile => {
      tile.classList.add('shake');
      setTimeout(() => tile.classList.remove('shake'), 300);
    });
    canCheck = true;
  }

  updateCheckButtonState();
}









    </script>
</body>
</html>
